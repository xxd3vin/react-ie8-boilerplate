 AutoFormComp.prototype=new ListenerUtil;AutoFormComp.prototype.componentType="AUTOFORM";AutoFormComp.SPACE_HEIGHT=1;AutoFormComp.focused=false;function AutoFormComp(parentDiv,id,renderType,renderHiddenEle,rowHeight,columnCount,attrArr){this.id=id;this.parentDiv=parentDiv;this.indiceArr=null;this.keyArr=new Array;this.eleArr=new Array;this.disableArr=new Array;this.readOnlyArr=new Array;this.dataset=null;this.rowIndex=-1;this.editable=true;this.readOnly=false;this.tmpEditable=true;this.renderHiddenEle=getBoolean(renderHiddenEle,false);this.dataCheckErrorRows=null;this.renderType=renderType;this.labelPosition="left";this.eleWidth="120";this.isShowLine=true;this.labelMinWidth="80";this.formRender=null;this.ellipsis=false;if(attrArr){this.labelPosition=getString(attrArr.labelPosition,this.labelPosition);this.eleWidth=getString(attrArr.eleWidth,this.eleWidth);this.isShowLine=getBoolean(attrArr.isShowLine,this.isShowLine);this.labelMinWidth=getString(attrArr.labelMinWidth,this.labelMinWidth);this.formRender=attrArr.formRender;this.ellipsis=getBoolean(attrArr.ellipsis,this.ellipsis);this.editable=getBoolean(attrArr.editable,this.editable);}this.initWholeErrorMsgDiv();var oThis=this;if (renderType==4){this.pLayout=new Object;this.pLayout.paint=function(){};}else if (renderType==2){this.pLayout=new FlowGridLayout(parentDiv,"flowGrid_"+id,0,0,"100%","100%","relative",true,this.eleWidth,10,this);this.pLayout.Div_gen.style.height="100px";this.pLayout.labelPosition=this.labelPosition;this.pLayout.ellipsis=this.ellipsis;this.pLayout.afterRepaint=function(){oThis.afterRepaint();}}else if (renderType==1 || renderType==3 || renderType==5){this.pLayout=new FixedGridLayout(parentDiv,"fixedGrid_"+id,0,0,"100%","100%","relative",true,this.eleWidth,10,rowHeight,columnCount,renderType,this);this.pLayout.labelPosition=this.labelPosition;}else if (renderType==6){this.pLayout=new ReadGridLayout(parentDiv,"readGrid_"+id,0,0,"100%","100%","relative",true,this.eleWidth,10,rowHeight,columnCount,this.formRender,this);this.pLayout.eleWidth=this.eleWidth;this.pLayout.labelMinWidth=this.labelMinWidth;}$(parentDiv).addClass("form_div");this.widget=null;ListenerUtil.call(this,true);if (AutoFormComp.firstForm==null) AutoFormComp.firstForm=this;};AutoFormComp.prototype.afterRepaint=function(){var childNodes=this.parentDiv.childNodes;var currNode=null;if (childNodes !=null){for ( var j=0;j<childNodes.length;j++){var child=childNodes[j];if (!IS_IE){if (child.nodeName=="#text") continue;}currNode=child;}}if(currNode==null){return;}currNode.style.height=this.getHeight()+AutoFormComp.SPACE_HEIGHT+"px";};AutoFormComp.prototype.removeElementById=function(id){if (this.renderType==4){var comp=this.getElement(id);if (comp){var newEles=new Array();var newKeyEles=new Array();for (var i=0;i<this.eleArr.length;i++){if (this.eleArr[i] !=comp){newEles.push(this.eleArr[i]);newKeyEles.push(this.eleArr[i].id);}}this.eleArr=newEles;this.keyArr=newKeyEles;if (comp.attachedLabel){var labelP=comp.attachedLabel.parentNode;if (labelP) labelP.removeChild(comp.attachedLabel);}var Div_gen=comp.getObjHtml();if (Div_gen){var p=Div_gen.parentNode;p.removeChild(Div_gen);}comp.destroy();}}else{var comp=this.pLayout.removeCompById(id);if (comp){var newEles=new Array();for (var i=0;i<this.eleArr.length;i++){if (this.eleArr[i] !=comp){newEles.push(this.eleArr[i]);}}this.eleArr=newEles;if (comp.attachedLabel){var labelP=comp.attachedLabel.parentNode;if (labelP) labelP.removeChild(comp.attachedLabel);}var Div_gen=comp.getObjHtml();if (Div_gen){var p=Div_gen.parentNode;p.removeChild(Div_gen);}comp.destroy();}}};AutoFormComp.prototype.createElement=function(eleId,field,eleWidth,height,rowSpan,colSpan,type,userObject,disabled,readOnly,dataset,labelName,labelColor,nextLine,required,tip,inputAssistant,showTip,description,isAttachNext,className,eleDiv,width,pkField,isShowLabel){var pdiv,position;if (className==null) className="text_div";if (this.renderType==1 || this.renderType==3 || this.renderType==5){pdiv=this.pLayout;position="relative";}else if (this.renderType==4){pdiv=eleDiv;position="relative";}else if (this.renderType==6){pdiv=eleDiv;position="relative";}else{pdiv=this.pLayout;position="absolute";}if (type==EditorType.IMAGECOMP){labelName="";}var ele;if (this.renderType==6 ){ele=new ReadElement(this,eleId,this.pLayout,eleWidth,height);ele.setEditorType(type);ele.setAttr(userObject);}else if (type==EditorType.CHECKBOX){ele=new CheckboxComp(pdiv,eleId,0,0,eleWidth,labelName,false,position,{"disabled":disabled,"readOnly":readOnly,"inputAssistant":inputAssistant,"showTipMessage":showTip});if (userObject&&userObject.valuePair) ele.setValuePair(userObject.valuePair);if (userObject&&userObject.visible==false) ele.visible=false;}else if (type==EditorType.REFERENCE){ele=new ReferenceTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant,"refType":userObject.refType,"refHeight":userObject.refHeight,"refWidth":userObject.refWidth,"isShowLine":this.isShowLine,"refFormId":this.id,"refFormeleID":eleId,"viewURL":userObject.viewURL},userObject.refNode,className);ele.setBindInfo(dataset,field,pkField);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.COMBOBOX){var dataDivHeight=userObject.dataDivHeight;ele=new ComboComp(pdiv,eleId,0,0,eleWidth,position,userObject.selectOnly,{"disabled":disabled,"multiSelect":userObject.multiSelect,"readOnly":readOnly,"dataDivHeight":dataDivHeight,"inputAssistant":inputAssistant,"allowExtendValue":userObject.allowExtendValue,"needNullOption":userObject.needNullOption},className);ele.setShowImgOnly(userObject.imageOnly);var comboData=userObject.comboData;if (comboData !=null){ele.setComboData(comboData);}if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.LANGUAGECOMBOBOX){var dataDivHeight=userObject.dataDivHeight;ele=new LanguageComboComp(pdiv,eleId,0,0,eleWidth,position,userObject.selectOnly,{"disabled":disabled,"readOnly":readOnly,"dataDivHeight":dataDivHeight,"inputAssistant":inputAssistant,"maxSize":userObject.maxLength,"tip":tip},className,userObject.currentLangCode,userObject.defaultLangCode);ele.setShowImgOnly(userObject.imageOnly);var langDataArray=userObject.langDataArray;if (langDataArray !=null){ele.setComboOptions(langDataArray);}if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.LIST){var dataDivHeight=userObject.dataDivHeight;ele=new ListComp(pdiv,eleId,0,0,eleWidth,dataDivHeight,false,position,className);var comboData=userObject.comboData;if (comboData !=null){ele.setComboData(comboData);}if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.RADIOGROUP){var widgetId=this.widget.id;ele=new RadioGroupComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"inputAssistant":inputAssistant});var comboData=userObject.comboData;if (comboData !=null || (window.editMode !=null&&window.editMode==true)){ele.setComboData(comboData);}if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.CHECKBOXGROUP){ele=new CheckboxGroupComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"inputAssistant":inputAssistant});var comboData=userObject.comboData;if (comboData !=null || (window.editMode !=null&&window.editMode==true)){ele.setComboData(comboData);}if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.PWDTEXT){ele=new PswTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"inputAssistant":inputAssistant},className);}else if (type==EditorType.INTEGERTEXT){var maxValue=userObject.maxValue !=null ? userObject.maxValue:null;var minValue=userObject.minValue !=null ? userObject.minValue:null;ele=new IntegerTextComp(pdiv,eleId,0,0,eleWidth,position,maxValue,minValue,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.DECIMALTEXT){var maxValue=userObject.maxValue !=null ? userObject.maxValue:null;var minValue=userObject.minValue !=null ? userObject.minValue:null;ele=new FloatTextComp(pdiv,eleId,0,0,eleWidth,position,userObject.precision,maxValue,minValue,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.TEXTAREA){ele=new TextAreaComp(pdiv,eleId,0,0,"","",position,readOnly,"",eleWidth,height,tip,className,{"maxSize":userObject.maxLength});var disabled=getBoolean(disabled,true);ele.setActive(!disabled);}else if (type==EditorType.DATETEXT){ele=new DateTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);}else if (type==EditorType.DATETIMETEXT){ele=new DateTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant,"editMin":userObject.editMin,"editSec":userObject.editSec},className);ele.setShowTimeBar(true);}else if (type==EditorType.MONTHTEXT){ele=new MonthTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly},className);}else if (type==EditorType.YEARTEXT){ele=new YearTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly},className);}else if (type==EditorType.YEARMONTHTEXT){ele=new YearMonthTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly},className);}else if (type==EditorType.TIMETEXT){ele=new TimeTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly},className);}else if (type==EditorType.SHORTDATETEXT){ele=new DateTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);ele.setHiddenDayBar(true);}else if (type==EditorType.IMAGECOMP){var refImg1='';var refImg2='';if (userObject.refImage1){refImg1=userObject.refImage1;}if (userObject.refImage2){refImg2=userObject.refImage2;}ele=new ImageComp(pdiv,eleId,refImg1,0,0,eleWidth,height,'',refImg2,{"position":"relative","disabled":disabled,"visible":userObject.visible,"baModule":userObject.baModule,"sysid":userObject.sysid,"canUpload":userObject.canUpload});ele.baseUrl=userObject.url;ele.pkField=userObject.pkfield;ele.getValue=function(){if (this.pk) return this.pk;else return this.refImg1;};if (userObject.refImage1 || userObject.refImage2){ele.setValue=function(){return;};}else{ele.setValue=function(value){var row=oThis.dataset.getSelectedRow();if (row==null) this.changeImage("","");else{var pkValue=row.getCellValue(oThis.dataset.nameToIndex(this.pkField));if (pkValue==null){if (value !=null){if (value=="") this.changeImage("","");else{try{var url=getFileService().execute("getDownUrl","$S_"+value,"$S_"+ele.sysid);this.changeImage(url,"");}catch(e){}}this.pk=value;var valueChangeEvent={"obj":this,"oldValue":"","newValue":value};this.doEventFunc("valueChanged",valueChangeEvent);}else this.changeImage("","");}else{var url=this.baseUrl.replace("$REPLACE$",pkValue);this.changeImage(url,url);}}};}}else if (type==EditorType.SIGNCOMP){ele=new SignComp(pdiv,eleId,0,0,eleWidth,height,{"verifyFields":userObject.verifyFields,"position":"relative","disabled":disabled,"visible":userObject.visible,"baModule":userObject.baModule,"sysid":userObject.sysid});var collectVerifyDateListener=new Listener("collectVerifyDate");collectVerifyDateListener.func=function(collectVerifyDateListener){var verifyFields=this.verifyFields;if (isNull(verifyFields)) return;var verifyDate="";var fieldsArr=verifyFields.split(",");for (var i=0;i<fieldsArr.length;i++){var value=oThis.dataset.getValue(fieldsArr[i]);if (!isNull(value)) verifyDate=verifyDate+value;}this.setVerifyValue(verifyDate);};ele.addListener(collectVerifyDateListener);if (this.signEleArr==null){this.signEleArr=new Array();}this.signEleArr.push(ele);}else if (type==EditorType.RICHEDITOR){var toolbarType=null;if (userObject&&userObject.toolbarType) toolbarType=userObject.toolbarType;ele=new EditorComp(pdiv,eleId,0,0,"100%","100%",position,null,toolbarType,{"baModule":userObject.baModule,"sysid":userObject.sysid});}else if (type==EditorType.SELFDEFELE){ele=new SelfDefElement(pdiv,eleId,0,0,eleWidth,height,position,null);var disabled=getBoolean(disabled,true);ele.setActive(!disabled);}else if (type==EditorType.FILECOMP){ele=new FileComp(pdiv,eleId,0,0,eleWidth,height,position,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant,"sizeLimit":userObject.sizeLimit,"baModule":userObject.baModule,"sysid":userObject.sysid,"billtype":userObject.billtype,"multi":userObject.multi,"fileExt":userObject.fileExt,"fileDesc":userObject.fileDesc,"fileMessage":userObject.fileMessage},className);}else if (type==EditorType.EMAILTEXT){ele=new EmailTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"maxSize":userObject.maxLength,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.PHONETEXT){ele=new PhoneTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"maxSize":userObject.maxLength,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.LINKTEXT){ele=new LinkTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"maxSize":userObject.maxLength,"tip":tip,"inputAssistant":inputAssistant,"linkType":userObject.linkType,"imgPath":userObject.imgPath,"target":userObject.target},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.MONEYTEXT){var maxValue=userObject.maxValue !=null ? userObject.maxValue:null;var minValue=userObject.minValue !=null ? userObject.minValue:null;ele=new MoneyTextComp(pdiv,eleId,0,0,eleWidth,position,userObject.precision,maxValue,minValue,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else if (type==EditorType.PRECENTTEXT){var maxValue=userObject.maxValue !=null ? userObject.maxValue:null;var minValue=userObject.minValue !=null ? userObject.minValue:null;ele=new PrecentTextComp(pdiv,eleId,0,0,eleWidth,position,userObject.precision,maxValue,minValue,{"disabled":disabled,"readOnly":readOnly,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}else{ele=new StringTextComp(pdiv,eleId,0,0,eleWidth,position,{"disabled":disabled,"readOnly":readOnly,"maxSize":userObject.maxLength,"tip":tip,"inputAssistant":inputAssistant},className);if (userObject.visible==false) ele.visible=false;}if (ele.Div_gen) ele.Div_gen.id=this.id+eleId;ele.fieldId=field;ele.showLabel=getBoolean(isShowLabel,true);ele.labelName=labelName;ele.showTipMessage=showTip;if (ele.inputAssistant==null) ele.inputAssistant=inputAssistant;ele.description=description;ele.isAttachNext=isAttachNext;ele.basewidth=eleWidth;ele.colSpan=colSpan;ele.rowSpan=rowSpan;ele.nextLine=nextLine;ele.isRequired=required;if (labelColor !=""&&labelColor !=null) ele.labelColor=labelColor;var oriIndex=-1;for (var xi=0;xi<this.keyArr.length;xi++){if (this.keyArr[xi]==eleId){oriIndex=xi;break;}}if(oriIndex !=-1){this.eleArr[oriIndex]=ele;}else{this.keyArr.push(eleId);this.eleArr.push(ele);}this.disableArr.push(disabled ? disabled:false);this.readOnlyArr.push(readOnly ? readOnly:false);var oThis=this;var textListener=new Listener("valueChanged");textListener.func=function(valueChangeEvent){if (oThis.rowIndex==-1) return;var index=oThis.dataset.nameToIndex((type==EditorType.LANGUAGECOMBOBOX)?valueChangeEvent.fieldId:this.fieldId);if (index==-1) return;if(type==EditorType.LANGUAGECOMBOBOX){oThis.dataset.setValueAt(oThis.rowIndex,index,this.getValue());if(valueChangeEvent.fieldId2 !=""){var languageDefaultIndex=oThis.dataset.nameToIndex(valueChangeEvent.fieldId2);oThis.dataset.setValueAt(oThis.rowIndex,languageDefaultIndex,this.getValue());}}else{var newValue=getString(this.getValue(),"");var oldValue=getString(oThis.dataset.getValueAt(oThis.rowIndex,index),"");if (newValue==oldValue) return;oThis.dataset.setValueAt(oThis.rowIndex,index,newValue);}};ele.addListener(textListener);var blurListener=new Listener("onBlur");blurListener.func=function(focusEvent){var obj=focusEvent.obj;if (ele.componentType=="EDITOR"){if (oThis.rowIndex==-1) return;if (this.readOnly==true) return;var index=oThis.dataset.nameToIndex(this.fieldId);if (index==-1) return;var newValue=this.getValue();var oldValue=oThis.dataset.getValueAt(oThis.rowIndex,index);if (getString(oldValue,"") !=getString(newValue,"")){oThis.dataset.setValueAt(oThis.rowIndex,index,newValue);if (window.pageUI) window.pageUI.setChanged(true);}}else{if (oThis.rowIndex==-1) return;var row=oThis.dataset.getRow(oThis.rowIndex);var colIndex=oThis.dataset.nameToIndex(obj.fieldId);if (colIndex==-1) return;var value=obj.getValue();if (value==null || value=="") oThis.dataset.checkDatasetCell(value,colIndex,row);if (oThis.renderType==1 || oThis.renderType==2){if (obj.hideFloatMessageDiv){obj.hideFloatMessageDiv();}}}};ele.addListener(blurListener);var focusListener=new Listener("onFocus");focusListener.func=function(focusEvent){var obj=focusEvent.obj;if (oThis.renderType==1 || oThis.renderType==2){if (obj.showFloatMessageDiv){obj.showFloatMessageDiv();}}};ele.addListener(focusListener);var formEleKeyListener=new Listener("onEnter");formEleKeyListener.func=function(keyEvent){var obj=keyEvent.obj;for (var i=0,n=oThis.eleArr.length-1;i<=n;i++){var ele=oThis.eleArr[i];if (obj==ele){var j=i+1;if (j>n ) j=0;var nextEle=oThis.eleArr[j];while (nextEle !=ele){if (nextEle.disabled !=null&&nextEle.disabled !=true&&nextEle.visible !=null&&nextEle.visible==true){if (nextEle.setDivFocus&&nextEle.setDivFocus(true)==true){break;}else if (nextEle.input !=null){nextEle.input.focus();break;}else if (nextEle.textArea !=null){nextEle.textArea.focus();break;}}j++;if (j>n ) j=0;nextEle=oThis.eleArr[j];}break;}}stopAll(keyEvent.event);};ele.addListener(formEleKeyListener);if (window.editMode){if (this.renderType !=4&&this.renderType !=6){var params={uiid:"",eleid:this.id,widgetid:this.widget ? this.widget.id:"",type:"formelement",subeleid:eleId,renderType:this.renderType};ele.params=params;if(!window.windowEditorMode){new EditableListener(ele.getObjHtml(),params,EditableListener.COMPOMENT_TYPE);}}}if (this.renderType==4){ele.formWidth=width;this.createType4Div(eleDiv,ele,className=="text_div"? null:className);}if(userObject&&userObject !=null&&typeof(userObject.visible)=="boolean"){ele.visible=userObject.visible;}else{ele.visible=true;}if(!ele.visible){if(this.renderType==4){if(ele.pDiv) ele.pDiv.style.display="none";}else{if(typeof(ele.hide)=="function") ele.hide();}}return ele;};AutoFormComp.resize=function(id){alert('resize');var ele=window.objects[id];try{AutoFormComp.type4Resize(ele);}catch(e){}};AutoFormComp.type4Resize=function(ele){if (ele==null) return;if (ele.outerDiv){if (ele.formWidth&&ele.formWidth.indexOf("%") !=-1){var outerWidth=parseInt(ele.formWidth)*ele.outerDiv.parentNode.offsetWidth/100;ele.outerDiv.style.width=outerWidth+"px";}}};AutoFormComp.prototype.updateType4Size=function(eleId,eleDiv,eleWidth){var ele=this.getElement(eleId);var divWidth=eleDiv.offsetWidth;if(eleWidth==null){eleWidth=ele.getObjHtml().offsetWidth;}if((typeof(eleWidth)=="string")&&(eleWidth.indexOf("%") !=-1)){ele.getObjHtml().style.width=eleWidth;return;}var labelWidth=divWidth-eleWidth-10;if(labelWidth<0){labelWidth=20;}if(labelWidth>120){labelWidth=120;}ele.attachedLabel.style.width=labelWidth+"px";ele.getObjHtml().style.left=(labelWidth+10)+"px";};AutoFormComp.prototype.setDsCellValue=function(id,value){if (this.rowIndex==-1) return;var index=this.dataset.nameToIndex(id);if (index==-1) return;var ele=this.getElement(id);value=value==null ? ele.getValue():value;this.dataset.setValueAt(this.rowIndex,index,value);};AutoFormComp.prototype.hideElement=function(key){for (var i=0;i<this.keyArr.length;i++){if (this.keyArr[i]==key) this.eleArr[i].hide();}};AutoFormComp.prototype.showElement=function(key){for (var i=0;i<this.keyArr.length;i++){if (this.keyArr[i]==key) this.eleArr[i].show();}};AutoFormComp.prototype.getElement=function(key){for (var i=0;i<this.keyArr.length;i++){if (this.keyArr[i]==key) return this.eleArr[i];}return null;};AutoFormComp.prototype.getElementByIndex=function(index){return this.eleArr[index];};AutoFormComp.prototype.getElements=function(){return this.eleArr;};AutoFormComp.prototype.setDataset=function(ds,index){this.dataset=ds;this.datasetIndex=index;if(typeof(this.datasetIndex)=="undefined"){var rows=ds.getSelectedRows();var row=rows==null ? null:rows[0];}else{var row=ds.getRow(this.datasetIndex);}this.indiceArr=new Array;for (var i=0,count=this.eleArr.length;i<count;i++){this.indiceArr[i]=ds.nameToIndex(this.eleArr[i].fieldId);var metadata=ds.metadata[this.indiceArr[i]];if (metadata&&metadata.precision !=null&&(this.eleArr[i].componentType=="FLOATTEXT"|| this.eleArr[i].componentType=="MONEYTEXT")){if(this.eleArr[i]&&typeof(this.eleArr[i].setPrecision)=='function'){this.eleArr[i].setPrecision(metadata.precision,true);}}if (row !=null){this.eleArr[i].setValue(row.getCellValue(this.indiceArr[i]),true);this.rowIndex=ds.getRowIndex(row);}else this.eleArr[i].setValue(null,true);}this.sign();ds.bindComponent(this);this.setEditable(ds.isEditable());this.pLayout.paint();if (typeof globalFormInitialized !="undefined") globalFormInitialized(this);};AutoFormComp.prototype.setEditable=function(editable){if(window.editMode) return;var e=editable;if (this.dataset.editable==false) e=false;this.editable=e;this.tmpEditable=e;if(typeof(this.datasetIndex)=="undefined"){if (this.dataset.editable==false || this.dataset.getSelectedRow()==null){this.tmpEditable=false;}}for (var i=0,count=this.eleArr.length;i<count;i++){if (this.readOnlyArr[i]&&this.tmpEditable) continue;if (this.disableArr[i]&&this.tmpEditable) continue;if (this.tmpEditable){this.eleArr[i].setActive(true);}else this.eleArr[i].setActive(false);}if(editable !=this.pLayout.editable){this.pLayout.editable=editable;this.pLayout.paint(true);}if(!IS_IPAD){setTimeout('AutoFormComp.firstEleFocus()',200);}};AutoFormComp.prototype.setReadOnly=function(readOnly){this.readOnly=readOnly;this.tmpReadOnly=readOnly;if (this.dataset.getSelectedRow()==null){this.tmpReadOnly=false;}for (var i=0,count=this.eleArr.length;i<count;i++){if (this.disableArr[i]&&!this.tmpReadOnly) continue;if (this.readOnlyArr[i]&&!this.tmpReadOnly) continue;if (this.tmpReadOnly) this.eleArr[i].setReadOnly(true);else this.eleArr[i].setReadOnly(false);}};AutoFormComp.prototype.getHeight=function(){if (this.renderType==1 || this.renderType==3){var pdiv=$ge("$d_"+this.id);return (pdiv.firstChild.rows.length-1)*22;}else return this.pLayout.getHeight();};AutoFormComp.prototype.onModelChanged=function(event){if (RowSelectEvent.prototype.isPrototypeOf(event) || FocusChangeEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex) !="undefined"){return;}var row=event.currentRow;this.rowIndex=event.currentRowIndex;for (var i=0;i<this.indiceArr.length;i++){if (row !=null){if("LANGUAGECOMBOBOX"==this.eleArr[i].componentType){var formComp=this;this.eleArr[i].setComboDatas(formComp,row);}else{this.eleArr[i].setValue(row.getCellValue(this.indiceArr[i]),true);}}else this.eleArr[i].setValue(null,true);}this.sign();if (this.editable !=this.tmpEditable){this.tmpEditable=this.editable;this.setEditable(this.editable);}if (row !=null){for (var i=0;i<this.indiceArr.length;i++){var eleHtml=this.eleArr[i].Div_gen;if (this.eleArr[i].Div_text){this.eleArr[i].setNormalStyle();}else if (eleHtml !=null&&eleHtml.className.indexOf(" checkedborder") !=-1) eleHtml.className=eleHtml.className.replace( " checkedborder","");if (this.eleArr[i].setMessage){if(eleHtml !=null&&eleHtml.className.indexOf("checkbox") !=-1){}else{if(this.eleArr[i].showTipMessage&&this.eleArr[i].showTipMessage !=null) this.eleArr[i].setMessage(this.eleArr[i].showTipMessage);else this.eleArr[i].setMessage(row.getCellValue(this.indiceArr[i]));}}}if (this.dataCheckErrorRows !=null&&this.dataCheckErrorRows.containsKey(row.rowId)){var value=this.dataCheckErrorRows.get(row.rowId);for (var i=0;i<value[0].length;i++){var index=value[0][i];var eleHtml=this.eleArr[index].Div_gen;if (this.eleArr[index].setError) this.eleArr[index].setError(true);if (this.eleArr[index].Div_text){if (value[2][i]==BaseComponent.ELEMENT_ERROR) this.eleArr[index].setErrorStyle();else if (value[2][i]==BaseComponent.ELEMENT_WARNING) this.eleArr[index].setWarningStyle();}else if (eleHtml.className.indexOf("checkedborder")==-1) eleHtml.className+=" checkedborder";if (this.eleArr[index].setErrorMessage) this.eleArr[index].setErrorMessage(value[1][i]);}}}}else if (RowUnSelectEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex) !="undefined"){return;}this.rowIndex=-1;var count=this.indiceArr.length;for (var i=0;i<count;i++) this.eleArr[i].setValue(null);}else if (DataChangeEvent.prototype.isPrototypeOf(event)){var i=this.getIndexByColIndex(event.cellColIndex);if(typeof(this.datasetIndex)=="undefined"|| (typeof(this.datasetIndex) !="undefined"&&this.datasetIndex==i)){if (i !=-1){if (this.eleArr[i].getValue&&this.eleArr[i].getValue() !=event.currentValue){var oldValue=this.eleArr[i].getValue();if(event.currentValue !=oldValue) this.eleArr[i].setValue(event.currentValue);}if (this.dataCheckErrorRows !=null&&this.dataCheckErrorRows .containsKey(event.currentRow.rowId)){var value=this.dataCheckErrorRows .get(event.currentRow.rowId);var colIndex=value[0].indexOf(event.cellColIndex);if (colIndex !=-1){value[0].splice(colIndex,1);value[1].splice(colIndex,1);}if (value[0].length==0) this.dataCheckErrorRows.remove(event.currentRow.rowId);}this.sign();}}}else if (DatasetUndoEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex)=="undefined"){var row=this.dataset.getSelectedRow();}else{var row=this.dataset.getRow(this.datasetIndex);}if (row !=null){this.rowIndex=this.dataset.getRowIndex(row);for (var i=0,count=this.indiceArr.length;i<count;i++){this.eleArr[i].setValue(row.getCellValue(this.indiceArr[i]));}}else{this.rowIndex=-1;for (var i=0,count=this.indiceArr.length;i<count;i++) this.eleArr[i].setValue("");}}else if (RowInsertEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex)=="undefined"){var row=this.dataset.getSelectedRow();}else{var row=this.dataset.getRow(this.datasetIndex);}if (row !=null){this.rowIndex=this.dataset.getRowIndex(row);for (var i=0;i<this.indiceArr.length;i++){this.eleArr[i].setValue(row.getCellValue(this.indiceArr[i]));if(this.eleArr[i].errorMsgDiv){this.eleArr[i].errorMsgDiv.style.display="none";}}this.sign();if(this.errorMsgDiv){this.errorMsgDiv.style.display="none";}}else{for (var i=0;i<this.indiceArr.length;i++){if(this.eleArr[i].errorMsgDiv){this.eleArr[i].errorMsgDiv.style.display="none";}}if(this.errorMsgDiv){this.errorMsgDiv.style.display="none";}}if (this==AutoFormComp.firstForm&&this.editable==true){setTimeout('AutoFormComp.firstEleFocus()',200);}}else if (PageChangeEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex)=="undefined"){this.rowIndex=this.dataset.getSelectedIndex();var row=this.dataset.getSelectedRow();}else{this.rowIndex=this.datasetIndex;var row=this.dataset.getRow(this.datasetIndex);}for (var i=0;i<this.indiceArr.length;i++){if (row !=null){this.eleArr[i].setValue(row.getCellValue(this.indiceArr[i]),true);}else this.eleArr[i].setValue(null,true);}this.sign();if (this.editable !=this.tmpEditable){this.tmpEditable=this.editable;this.setEditable(this.editable);}}else if (RowDeleteEvent.prototype.isPrototypeOf(event)){if(typeof(this.datasetIndex)=="undefined"){this.rowIndex=this.dataset.getSelectedIndex();for (var i=0;i<this.indiceArr.length;i++) this.eleArr[i].setValue(null);}}else if (DataCheckEvent.prototype.isPrototypeOf(event)){if (this.renderType==6) return;var colIndice=event.cellColIndices;var describes=event.rulesDescribe;var row=event.currentRow;var currentIndex=this.dataset.getRowIndex(row);if(typeof(this.datasetIndex) !="undefined"&&this.datasetIndex !=currentIndex){return;}var eleIndex=-1;var success=true;for (var i=0,count=colIndice.length;i<count;i++){if ((eleIndex=this.indiceArr.indexOf(colIndice[i])) !=-1){var value=row.getCellValue(colIndice);var eleRequired=this.eleArr[eleIndex].isRequired;if (describes[i]==""&&((value==null || value=="")&&eleRequired)){describes[i]=trans('ml_thisfieldcannotnull');}var eleHtml=this.eleArr[eleIndex].Div_gen;if (describes[i] !=""&&((value !=null&&value !="") || ((value==null || value=="")&&eleRequired))){var errorType=BaseComponent.ELEMENT_ERROR;var userCheckResult=null;if (typeof selfDefDataCheck !="undefined"){userCheckResult=selfDefDataCheck(this.dataset.id,this.dataset.metadata[colIndice[i]].key,value);if (userCheckResult) errorType=userCheckResult.type;}if (userCheckResult !=null){if (userCheckResult.type==BaseComponent.ELEMENT_ERROR){AutoFormComp.setElementErrorMessage( this.eleArr[eleIndex],BaseComponent.ELEMENT_ERROR,userCheckResult.describe,this.renderType,this);}else if (userCheckResult.type==BaseComponent.ELEMENT_WARNING){AutoFormComp.setElementErrorMessage( this.eleArr[eleIndex],BaseComponent.ELEMENT_WARNING,userCheckResult.describe,this.renderType,this);}}else{AutoFormComp.setElementErrorMessage( this.eleArr[eleIndex],BaseComponent.ELEMENT_ERROR,describes[i],this.renderType,this);}if (this.eleArr[eleIndex].setError) this.eleArr[eleIndex].setError(true);if (this.eleArr[eleIndex].Div_text){if (userCheckResult !=null){if (userCheckResult.type==BaseComponent.ELEMENT_ERROR){this.eleArr[eleIndex].setErrorStyle();if (this.eleArr[eleIndex].setCheckResult) this.eleArr[eleIndex] .setCheckResult(BaseComponent.ELEMENT_ERROR);}else if (userCheckResult.type==BaseComponent.ELEMENT_WARNING){this.eleArr[eleIndex].setWarningStyle();if (this.eleArr[eleIndex].setCheckResult) this.eleArr[eleIndex] .setCheckResult(BaseComponent.ELEMENT_WARNING);}}else{this.eleArr[eleIndex].setErrorStyle();}}else if (eleHtml.className.indexOf(" checkedborder")==-1){eleHtml.className+=" checkedborder";}if (this.eleArr[eleIndex].setErrorMessage){if (userCheckResult !=null) this.eleArr[eleIndex] .setErrorMessage(userCheckResult.describe);else this.eleArr[eleIndex].setErrorMessage(describes[i]);}if (this.dataCheckErrorRows==null) this.dataCheckErrorRows=new HashMap();if ((this.dataCheckErrorRows.containsKey(row.rowId))==false) this.dataCheckErrorRows.put(row.rowId,[[eleIndex],[describes[i]],[errorType]]);else{var value=this.dataCheckErrorRows.get(row.rowId);value[0].push(eleIndex);value[1].push(describes[i]);value[2].push(errorType);}success=false;}else{if (value==null || value==""){AutoFormComp.setElementErrorMessage( this.eleArr[eleIndex],BaseComponent.ELEMENT_NORMAL,this.eleArr[eleIndex].inputAssistant,this.renderType,this);if (this.eleArr[eleIndex].setCheckResult) this.eleArr[eleIndex] .setCheckResult(BaseComponent.ELEMENT_NORMAL);}else{AutoFormComp.setElementErrorMessage( this.eleArr[eleIndex],BaseComponent.ELEMENT_SUCCESS,"",this.renderType,this);if (this.eleArr[eleIndex].setCheckResult) this.eleArr[eleIndex] .setCheckResult(AutoFormComp.ELEMENT_SUCESS);}if (this.eleArr[eleIndex].Div_text){this.eleArr[eleIndex].setNormalStyle();}else{var className=eleHtml.className.replace( " checkedborder","");eleHtml.className=className;}if (this.eleArr[eleIndex].setError) this.eleArr[eleIndex].setError(false);var title=row.getCellValue(colIndice);if (this.eleArr[eleIndex].setMessage){if(this.eleArr[eleIndex].showTipMessage&&this.eleArr[eleIndex].showTipMessage !=null) this.eleArr[eleIndex].setMessage(this.eleArr[eleIndex].showTipMessage);else{if(this.eleArr[eleIndex].componentType=="FLOATTEXT") title=this.eleArr[eleIndex].getFormater().format(title);if(this.eleArr[eleIndex].componentType=="CHECKBOX") title=this.eleArr[eleIndex].text;if(this.eleArr[eleIndex].componentType=="PSWTEXT") title="";this.eleArr[eleIndex].setMessage(title);}}if (this.dataCheckErrorRows==null) this.dataCheckErrorRows=new HashMap();if ((this.dataCheckErrorRows.containsKey(row.rowId))==true) this.dataCheckErrorRows.remove(row.rowId);}}}if (success==true){this.DataCheckSuccess(event);}else{this.DataCheckFailed(event);}}else if (MetaChangeEvent.prototype.isPrototypeOf(event)){if (event.precision !=null){if(typeof(this.datasetIndex)=="undefined"|| this.datasetIndex==event.colIndex){var index=this.getIndexByColIndex(event.colIndex);}else{return;}if (this.eleArr[index] !=null&&typeof(this.eleArr[index].setPrecision)=='function'){this.eleArr[index].setPrecision(event.precision,true);}}}};AutoFormComp.prototype.getIndexByColIndex=function(colIndex){if (this.indiceArr==null) return-1;for (var i=0,count=this.indiceArr.length;i<count;i++){if (this.indiceArr[i]==colIndex){return i;}}return-1;};AutoFormComp.prototype.sign=function(){if (this.signEleArr==null) return;for (var i=0;i<this.signEleArr.length;i++){this.signEleArr[i].collectVerifyDate();}};AutoFormComp.setElementErrorMessage=function(element,type,message,renderType,formcomp){if (type==BaseComponent.ELEMENT_ERROR){if(typeof(element)=="object"&&typeof(element.errorMsgDiv) !='undefined'){if(typeof(element.setError)=='function'){element.setError(true);}if(typeof(element.setErrorMessage)=='function'){element.setErrorMessage(message);}if(typeof(element.setErrorStyle)=='function'){element.setErrorStyle();}if(typeof(element.setErrorPosition)=='function'){element.setErrorPosition();}}}else if (type==BaseComponent.ELEMENT_WARNING){if(typeof(element.setError)=='function'){}}else if (type==BaseComponent.ELEMENT_SUCCESS){if(typeof(element)=="object"){if(typeof(element.setError)=='function'){element.setError(false);}if(typeof(element.setErrorMessage)=='function'){element.setErrorMessage("");}if(typeof(element.setNormalStyle)=='function'){element.setNormalStyle();}if(element.errorMsgDiv) element.errorMsgDiv.style.display="none";}}else if (type==BaseComponent.ELEMENT_NORMAL){if(typeof(element.setError)=='function'){}}};AutoFormComp.prototype.initWholeErrorMsgDiv=function(isUp){var oThis=this;this.errorMsgDiv=$ce("DIV");this.errorMsgDiv.id=this.id+"_error_whole_msg_id";this.errorMsgDiv.style.display="none";this.errorMsgDiv.className="form_error_whole_msg_div";var prefix="down_";if(isUp){prefix="up_";this.errorMsgDiv.style.top="30px";}this.wholeMsgDiv=$ce("DIV");this.wholeMsgDiv.className="whole_msg_div";this.errorMsgDiv.appendChild(this.wholeMsgDiv);this.leftTopDiv=$ce("DIV");this.leftTopDiv.className=prefix+"bg_left_top";this.wholeMsgDiv.appendChild(this.leftTopDiv);this.topMiddleDiv=$ce("DIV");this.topMiddleDiv.className=prefix+"bg_top_middle";this.wholeMsgDiv.appendChild(this.topMiddleDiv);this.rightTopDiv=$ce("DIV");this.rightTopDiv.className=prefix+"bg_right_top";this.wholeMsgDiv.appendChild(this.rightTopDiv);this.rightMiddleDiv=$ce("DIV");this.rightMiddleDiv.className=prefix+"bg_right_middle";this.wholeMsgDiv.appendChild(this.rightMiddleDiv);this.rightBottomDiv=$ce("DIV");this.rightBottomDiv.className=prefix+"bg_right_bottom";this.wholeMsgDiv.appendChild(this.rightBottomDiv);this.bottomMiddleDiv=$ce("DIV");this.bottomMiddleDiv.className=prefix+"bg_bottom_middle";this.wholeMsgDiv.appendChild(this.bottomMiddleDiv);this.leftBottomDiv=$ce("DIV");this.leftBottomDiv.className=prefix+"bg_left_bottom";this.wholeMsgDiv.appendChild(this.leftBottomDiv);this.leftMiddleDiv=$ce("DIV");this.leftMiddleDiv.className=prefix+"bg_left_middle";this.wholeMsgDiv.appendChild(this.leftMiddleDiv);this.errorCenterDiv=$ce("DIV");this.errorCenterDiv.className=prefix+"error_center_div";this.wholeMsgDiv.appendChild(this.errorCenterDiv);this.errorMsg=$ce("DIV");this.errorMsg.className="errorMsg";this.errorCenterDiv.appendChild(this.errorMsg);if(IS_IE&&!IS_IE9){}this.warningIcon=$ce("DIV");this.warningIcon.className=prefix+"warning";this.wholeMsgDiv.appendChild(this.warningIcon);this.closeIcon=$ce("DIV");this.closeIcon.className=prefix+"close_normal";this.closeIcon.onmouseover=function(e){this.className=prefix+"close_press";};this.closeIcon.onmouseout=function(e){this.className=prefix+"close_normal";};this.closeIcon.onmouseup=function(e){this.className=prefix+"close_normal";oThis.errorMsgDiv.style.display="none";};this.wholeMsgDiv.appendChild(this.closeIcon);this.parentDiv.appendChild(this.errorMsgDiv);};AutoFormComp.prototype.hideErrorMsg=function(){if(this.errorMsgDiv){this.errorMsgDiv.style.display="none";}};AutoFormComp.prototype.resetWholeErrorMsgDivStyle=function(isUp){var oThis=this;var prefix="down_";if(isUp){prefix="up_";this.errorMsgDiv.style.top="30px";}this.leftTopDiv.className=prefix+"bg_left_top";this.topMiddleDiv.className=prefix+"bg_top_middle";this.rightTopDiv.className=prefix+"bg_right_top";this.rightMiddleDiv.className=prefix+"bg_right_middle";this.rightBottomDiv.className=prefix+"bg_right_bottom";this.bottomMiddleDiv.className=prefix+"bg_bottom_middle";this.leftBottomDiv.className=prefix+"bg_left_bottom";this.leftMiddleDiv.className=prefix+"bg_left_middle";this.errorCenterDiv.className=prefix+"error_center_div";this.warningIcon.className=prefix+"warning";this.closeIcon.className=prefix+"close_normal";this.closeIcon.onmouseover=function(e){this.className=prefix+"close_press";};this.closeIcon.onmouseout=function(e){this.className=prefix+"close_normal";};this.closeIcon.onmouseup=function(e){this.className=prefix+"close_normal";oThis.errorMsgDiv.style.display="none";};};AutoFormComp.prototype.setWholeErrorPosition=function(){var parentElement=this.parentDiv.parentNode;var tempTop=0;var tempLeft=0;while(typeof(parentElement)=="object"){if(parentElement.id&&parentElement.id.indexOf('_um') !=-1){parentElement.appendChild(this.errorMsgDiv);if(tempTop>40){this.resetWholeErrorMsgDivStyle(true);}this.errorMsgDiv.style.visibility="hidden";this.errorMsgDiv.style.display="block";this.errorMsgDiv.style.display="none";this.errorMsgDiv.style.visibility="visible";break;}if(typeof(parentElement.offsetLeft)=='number'){tempLeft+=parentElement.offsetLeft;}if(typeof(parentElement.offsetTop)=='number'){tempTop+=parentElement.offsetTop;}if(typeof(parentElement.parentOwner)=="object"){parentElement=parentElement.parentOwner;}else{parentElement=parentElement.parentNode;}}};AutoFormComp.prototype.DataCheckSuccess=function(dataCheckEvent){this.doEventFunc("onSuccess",dataCheckEvent);};AutoFormComp.prototype.DataCheckFailed=function(dataCheckEvent){this.doEventFunc("onFailed",dataCheckEvent);};AutoFormComp.prototype.createType4Div=function(pDiv,comp,className){var oThis=this;var outerWidth=0;var needResize=false;comp.pDiv=pDiv;comp.labelClassName=className;if (comp.formWidth==null) outerWidth=pDiv.offsetWidth;else{if (typeof(comp.formWidth)=='string'&&comp.formWidth.indexOf("%") !=-1){outerWidth=parseInt(comp.formWidth)*pDiv.offsetWidth/100;needResize=true;}else outerWidth=comp.formWidth;}var outerDiv=$ce("DIV");if (pDiv.outerDiv !=null) pDiv.oldOuterDiv=pDiv.outerDiv;pDiv.outerDiv=outerDiv;outerDiv.style.width=outerWidth+"px";outerDiv.style.height="100%";if (needResize){comp.outerDiv=outerDiv;window.objects[this.id+"$"+comp.id]=comp;addResizeEvent(pDiv,function(){});}pDiv.appendChild(outerDiv);var labelWidth=0;var label=comp.labelName;var labelDiv=null;var compOuterDiv=null;if(comp.showLabel&&label !=null&&label !=""){if (comp.componentType=="CHECKBOX") label="";labelDiv=$ce("DIV");if (className) labelDiv.className=className;labelDiv.style.textAlign="right";labelDiv.style.paddingTop="2px";labelDiv.style.paddingRight="5px";labelDiv.style[ATTRFLOAT]="left";labelDiv.style.position="relative";labelDiv.innerHTML=label;if (comp.labelColor) labelDiv.style.color=comp.labelColor;if (comp.isRequired&&label !=null){var span=$ce("span");span.style.color="red";span.innerHTML="*";labelDiv.appendChild(span);labelWidth=getTextWidth(label+"*",className);}else labelWidth=getTextWidth(label,null);outerDiv.appendChild(labelDiv);if (comp.basewidth.indexOf('%')==-1){labelWidth=outerWidth-comp.basewidth-5;labelWidth=labelWidth>=0 ? labelWidth:0;}else{compOuterDiv=$ce("DIV");compOuterDiv.id="compOuter";compOuterDiv.style[ATTRFLOAT]="right";compOuterDiv.style.height="100%";compOuterDiv.style.position="relative";var compWidth=outerWidth-labelWidth-5;if (compWidth<0) compWidth=0;compOuterDiv.style.width=compWidth+"px";if (comp.componentType=="TEXTAREA"&&IS_IE8) comp.setBounds(0,0,compWidth,null);else comp.setBounds(0,0,compWidth,comp.height);}labelDiv.style.width=labelWidth+"px";labelDiv.style.whiteSpace="nowrap";labelDiv.style.overflow="hidden";labelDiv.style.textOverflow="ellipsis";labelDiv.title=label;}var objHtml=comp.getObjHtml();if (objHtml !=null){if (compOuterDiv !=null){outerDiv.appendChild(compOuterDiv);compOuterDiv.appendChild(objHtml);}else{objHtml.style[ATTRFLOAT]="right";outerDiv.appendChild(objHtml);}}comp.attachedLabel=labelDiv;};AutoFormComp.prototype.repaintType4Div=function(comp){this.createType4Div(comp.pDiv,comp,comp.labelClassName);if (comp.pDiv.oldOuterDiv) comp.pDiv.removeChild(comp.pDiv.oldOuterDiv);};AutoFormComp.prototype.destroySelf=function(){};AutoFormComp.prototype.createType4DivTop=function(pDiv,comp){var label=comp.labelName;var labelDiv=null;if(label !=null&&label !=""){if (comp.componentType=="CHECKBOX") label="";labelDiv=$ce("DIV");labelDiv.style.textAlign="left";labelDiv.style.paddingTop="2px";labelDiv.style.position="relative";labelDiv.innerHTML=label;if (comp.labelColor) labelDiv.style.color=comp.labelColor;if (comp.isRequired&&label !=null){var span=$ce("span");span.style.color="red";span.innerHTML="*";labelDiv.appendChild(span);}pDiv.appendChild(labelDiv);}var objHtml=comp.getObjHtml();if (objHtml !=null){pDiv.appendChild(objHtml);}comp.attachedLabel=labelDiv;};SelfDefElement.prototype=new BaseComponent;SelfDefElement.prototype.componentType="SELFDEFELEMENT";function SelfDefElement(parent,name,left,top,width,height,position,attrArr){if (arguments.length==0) return;this.base=BaseComponent;this.base(name,left,top,width,height);this.parentOwner=parent;this.position=getString(position,"absolute");this.disabled=false;this.visible=true;this.value="";if (attrArr !=null){this.disabled=getBoolean(attrArr.disabled,false);this.value=getString(attrArr.value,this.value);}this.labelName="";this.create();};SelfDefElement.prototype.create=function(){var oThis=this;this.Div_gen=$ce("DIV");this.Div_gen.id=this.name;this.Div_gen.style.position=this.position;this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";this.Div_gen.style.width=this.width;this.Div_gen.style.height=this.height;this.Div_gen.style.overflow="hidden";if (this.parentOwner) this.placeIn(this.parentOwner);};SelfDefElement.prototype.manageSelf=function(){var oThis=this;if (this.disabled==true){this.setActive(false);}if (this.value) this.setValue(this.value);this.Div_gen.onblur=function(e){e=EventUtil.getEvent();oThis.onblur(e);clearEventSimply(e);};this.Div_gen.onmouseover=function(e){e=EventUtil.getEvent();oThis.onmouseover(e);clearEventSimply(e);};this.Div_gen.onclick=function(e){e=EventUtil.getEvent();oThis.onclick(e);clearEventSimply(e);};this.Div_gen.onkeypress=function (e){e=EventUtil.getEvent();var keyCode=e.lfwKey;if (keyCode==13){oThis.onenter(e);clearEventSimply(e);return true;}};};SelfDefElement.prototype.setContent=function(contentObj){if (window.editMode !=null&&window.editMode==true){this.Div_gen.appendChild(document.createTextNode("自定义控件"));return;}this.content=contentObj;if (contentObj instanceof BaseComponent){if(contentObj.Div_gen.parentNode) this.Div_gen.appendChild(contentObj.Div_gen.parentNode);else this.Div_gen.appendChild(contentObj.Div_gen);}else this.Div_gen.appendChild(contentObj);};SelfDefElement.prototype.getContent=function(){return this.content;};SelfDefElement.prototype.setError=function(error){};SelfDefElement.prototype.setNormalStyle=function(){};SelfDefElement.prototype.setDivFocus=function(isFocus){if (this.content&&this.content.contentObj&&this.content.contentObj.setDivFocus){this.content.contentObj.setDivFocus(isFocus);return true;}else return false;};SelfDefElement.prototype.setActive=function(isActive){var isActive=getBoolean(isActive,false);if (isActive) this.active();else this.inActive();this.disabled=!isActive;if (this.content&&this.content.setActive) this.content.setActive(isActive);this.notifyChange(NotifyType.ENABLE,!this.disabled);};SelfDefElement.prototype.active=function(){var simpleEvent={"obj":this};this.doEventFunc("active",simpleEvent);};SelfDefElement.prototype.inActive=function(){var simpleEvent={"obj":this};this.doEventFunc("inActive",simpleEvent);};SelfDefElement.prototype.setValue=function(value){if (this.content !=null&&this.content.contentObj !=null) this.content.contentObj.setValue(value);};SelfDefElement.prototype.onblur=function(e){var focusEvent={"obj":this,"event":e};this.doEventFunc("onBlur",focusEvent);};SelfDefElement.prototype.onclick=function(e){var mouseEvent={"obj":this,"event":e};this.doEventFunc("onclick",mouseEvent);};SelfDefElement.prototype.onmouseover=function(e){var mouseEvent={"obj":this,"event":e};this.doEventFunc("onmouseover",mouseEvent);};SelfDefElement.prototype.onenter=function(e){var keyEvent={"obj":this,"event":e};this.doEventFunc("onEnter",keyEvent);};SelfDefElement.prototype.getValue=function(){if (this.content !=null&&this.content.contentObj !=null) return this.content.contentObj.getValue();};SelfDefElement.prototype.setBounds=function(left,top,width,height){this.left=left;this.top=top;this.width=getString(convertWidth(width),this.Div_gen.offsetWidth+"px");this.height=getString(convertHeight(height),this.Div_gen.offsetHeight+"px");this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";this.Div_gen.style.width=this.width;this.Div_gen.style.height=this.height;};AutoFormComp.prototype.getChangedContext=function(){if (this.changedObj==null){this.changedObj=new Object;this.changedObj.id=this.id;}delete this.changedObj["eles"];if(this.getElements().length>0){this.changedObj["eles"]=new Array();for (var i=0,n=this.getElements().length;i<n;i++){var ctx=this.getElementByIndex(i).getChangedContext();if (ctx==null) continue;this.changedObj["eles"].push(ctx);}}return this.changedObj;};AutoFormComp.prototype.setChangedContext=function(context){if (context.enable !=null&&(this.editable==null || this.editable !=context.enable)) this.setEditable(context.enable);if (context.readOnly !=null&&(this.readOnly==null || this.readOnly !=context.readOnly)) this.setReadOnly(context.readOnly);if (context.hideErrorMsg !=null) this.hideErrorMsg();if (context.focus !=null) this.setFocus(context.focus);if(context.rowHeight !=null || context.columnCount !=null || context.eleWidth !=null) this.paint(context);if (context.elementContexts){for (var i=0,n=context.elementContexts.length;i<n;i++){for (var j=0,m=this.getElements().length;j<m;j++){if (this.getElementByIndex(j).id==context.elementContexts[i].id){var ctx=context.elementContexts[i];var comp=this.getElementByIndex(j);if(ctx.enable !=null) this.setEleEnabled(comp.id,ctx.enable);if (ctx.visible !=null) this.setEleVisible(comp.id,ctx.visible);if(ctx.focus !=null) this.setEleFocus(comp.id,ctx.focus);if(ctx.editable !=null) this.setEleEditable(comp.id,ctx.editable);if(ctx.colSpan !=null) this.setEleColspan(comp.id,ctx.colSpan);if(ctx.rowSpan !=null) this.setEleRowspan(comp.id,ctx.rowSpan);if(ctx.beforeOpenParam !=null) comp.beforeOpenParam(ctx.beforeOpenParam);if(ctx.matchValues !=null&&comp.setMatchValues) comp.setMatchValues(ctx.matchValues);if(ctx.text !=null) this.setEleLabel(comp.id,ctx.text);if(ctx.maxLength !=null&&comp.setMaxSize) comp.setMaxSize(ctx.maxLength);if(ctx.maxValue !=null&&comp.setMaxValue) comp.setMaxValue(ctx.maxValue);if(ctx.minValue !=null&&comp.setMinValue) comp.setMinValue(ctx.minValue);if(ctx.precision !=null&&comp.setPrecision) comp.setPrecision(ctx.precision);if(ctx.showValue !=null&&comp.setPrecision) comp.setPrecision(ctx.showValue);if(ctx.labelColor !=null) this.setEleLabelColor(comp.id,ctx.labelColor);if(ctx.nullAble !=null) this.setEleRequired(comp.id,ctx.nullAble);if(ctx.viewURL !=null) this.setViewURL(comp.id,ctx.viewURL);if(ctx.sizeLimit !=null&&comp.setSizeLimit) comp.setSizeLimit(ctx.sizeLimit);if(ctx.selectOnly !=null&&comp.setSelectOnly) comp.setSelectOnly(ctx.selectOnly);if(ctx.allowExtendValue !=null&&comp.setAllowExtendValue) comp.setAllowExtendValue(ctx.allowExtendValue);if(ctx.showLabel !=null) this.setShowLabel(comp,ctx.showLabel);}}}}};AutoFormComp.prototype.notifyChange=function(type,value){if (isReturning()) return;if (type==null) return;if (this.changedObj==null){this.changedObj=new Object;this.changedObj.id=this.id;}this.changedObj[type]=value;};AutoFormComp.prototype.clearChange=function(){delete this.changedObj;for (var i=0,n=this.getElements().length;i<n;i++){var ele=this.getElementByIndex(i);ele.clearChange();}};AutoFormComp.prototype.setEleLabelColor=function(id,labelColor){var comp=this.getElement(id);var needRepaint=false;if (labelColor&&comp.labelColor !=labelColor){comp.labelColor=labelColor;if (comp.attachedLabel !=null) comp.attachedLabel=null;if (this.renderType==4){this.repaintType4Div(comp);}else needRepaint=true;}if (needRepaint){this.toRepaint();}};AutoFormComp.prototype.setEleEnabled=function(id,enabled){var comp=this.getElement(id);if (comp==null) return;if (this.editable==false) enabled=false;if (comp.setActive){comp.setActive(enabled);}};AutoFormComp.prototype.setEleVisible=function(id,visible){var comp=this.getElement(id);var needRepaint=false;if(this.renderType==4){if (comp.visible !=visible){comp.visible=visible;if(visible==true){if (comp.pDiv) comp.pDiv.style.display="block";}else{if (comp.pDiv) comp.pDiv.style.display="none";}}}else{if (comp.visible !=visible){comp.visible=visible;if(visible==true){if(typeof(comp.show)=="function"){comp.show();}}else{if(typeof(comp.hide)=="function"){comp.hide();}}needRepaint=true;}if (needRepaint){this.toRepaint();}}};AutoFormComp.prototype.setEleFocus=function(id,focus){var comp=this.getElement(id);if (focus==true&&comp.setFocus){this.focusComp=comp;comp.setFocus();}};AutoFormComp.prototype.setElePrecision=function(id,precision){var comp=this.getElement(id);if (comp.setPrecision){comp.setPrecision(precision);}};AutoFormComp.prototype.setEleEditable=function(id,editable){var comp=this.getElement(id);if(this.readOnly==true) editbale=false;if (comp.readOnly !=null&&comp.readOnly==editable){comp.setReadOnly(!editable);}};AutoFormComp.prototype.setEleColspan=function(id,colSpan){var needRepaint=false;var comp=this.getElement(id);if (comp.colSpan !=null&&comp.colSpan !=colSpan){comp.colSpan=colSpan;needRepaint=true;}if(needRepaint) this.toRepaint();};AutoFormComp.prototype.setEleRowspan=function(id,rowSpan){var needRepaint=false;var comp=this.getElement(id);if (comp.rowSpan !=null&&comp.rowSpan !=rowSpan){comp.rowSpan=rowSpan;needRepaint=true;}if(needRepaint) this.toRepaint();};AutoFormComp.prototype.setEleLabel=function(id,label){var comp=this.getElement(id);if(comp.componentType=="CHECKBOX") comp.setLabelText(label);else{var needRepaint=false;if (label !=null&&comp.labelName !=label){comp.labelName=label;if (this.renderType==4){this.repaintType4Div(comp);}else needRepaint=true;}if (needRepaint){this.toRepaint();}}};AutoFormComp.prototype.setShowLabel=function(comp,showLabel){showLabel=getBoolean(showLabel,true);if (showLabel==comp.showLabel) return;comp.showLabel=showLabel;if (this.renderType==4) this.repaintType4Div(comp);else this.toRepaint();};AutoFormComp.prototype.setEleRequired=function(id,nullAble){var comp=this.getElement(id);var needRepaint=false;if (true){comp.isRequired=!nullAble;if (this.renderType==4){this.repaintType4Div(comp);}else needRepaint=true;}if (needRepaint){this.toRepaint();}};AutoFormComp.prototype.setViewURL=function(id,viewURL){var comp=this.getElement(id);if(comp.setViewURL){comp.setViewURL(viewURL);}};AutoFormComp.prototype.toRepaint=function(){if(AutoFormComp.repaintRt !=null&&AutoFormComp.repaintId !=null&&AutoFormComp.repaintId==this.id) clearTimeout(AutoFormComp.repaintRt);AutoFormComp.repaintRt=setTimeout("AutoFormComp.repaintSelf('"+this.widget.id+"', '"+this.id+"')",200);AutoFormComp.repaintId=this.id;};AutoFormComp.repaintSelf=function(widgetId,formid){var form=pageUI.getWidget(widgetId).getComponent(formid);form.pLayout.paint(true);};AutoFormComp.prototype.paint=function(context){var needRepaint=false;if (this.renderType==2) return;if(context.rowHeight !=null&&this.pLayout.rowHeight !=context.rowHeight){this.pLayout.rowHeight=context.rowHeight;needRepaint=true;}if(context.columnCount !=null&&this.pLayout.columnCount !=context.columnCount){this.pLayout.columnCount=context.columnCount;needRepaint=true;}if(context.eleWidth !=null&&this.basewidth !=context.eleWidth){this.pLayout.basewidth=context.eleWidth;needRepaint=true;}if(needRepaint) this.toRepaint();};AutoFormComp.firstEleFocus=function(){if (AutoFormComp.focusFirstEle==true) return;if (AutoFormComp.firstForm==null) return;var form=AutoFormComp.firstForm;if (form.editable==false) return;var firstEle=null;for (var i=0;i<form.eleArr.length;i++){var ele=form.eleArr[i];if (ele.visible !=null&&ele.visible==true&&ele.disabled !=null&&ele.disabled !=true&&ele.componentType !="SELFDEFELEMENT"&&ele.componentType !="EDITOR"){firstEle=ele;break;}}if(typeof(form.focusComp) !="undefined"&&form.focusComp !=firstEle) return;if(firstEle !=null){form.focusComp=firstEle;if (firstEle.setDivFocus) firstEle.setDivFocus(true);else if (firstEle.input !=null){firstEle.input.focus();}else if (firstEle.textArea !=null){setTimeout(function(){firstEle.textArea.focus();},0);}}};AutoFormComp.prototype.setFocus=function(focus){if(focus){AutoFormComp.firstForm=this;}else{AutoFormComp.firstForm=null;}AutoFormComp.firstEleFocus();};
FixedGridLayout.prototype.className="FixedGridLayout";FixedGridLayout.prototype=new PanelComp;FixedGridLayout.SPACE_HEIGHT=10;function FixedGridLayout(parent,name,left,top,width,height,position,scroll,compDefaultWidth,marginTop,rowHeight,columnCount,renderType,form){this.base=PanelComp;this.base(parent,name,left,top,width,height,position,scroll);this.parentOwner=parent;this.defaultwidth=getString(compDefaultWidth,"120");this.basewidth=this.defaultwidth;this.gridWidth=0;this.colmNum=0;this.lastX=0;this.wordsdefault=5;this.comps=new Array();this.marginTop=getInteger(marginTop,6);this.currentRow=null;this.rowHeight=getInteger(rowHeight,22);this.columnCount=getInteger(columnCount,2);this.maxCellsWidth=new Array(this.columnCount);this.maxCompsWidth=new Array(this.columnCount);this.maxLabelWidth=new Array(this.columnCount);this.forceRepaint=false;if (FixedGridLayout.syncArray==null){FixedGridLayout.syncArray=new Array;}FixedGridLayout.syncArray.push(this);if (FixedGridLayout.wordArray==null) FixedGridLayout.wordArray=new Array;FixedGridLayout.COMPHEIGHT=getCssHeight("text_form_div_COMPHEIGHT");this.labelPosition="left";this.renderType=renderType;this.form=form;};FixedGridLayout.prototype.create=function(){var oThis=this;this.Div_gen=document.createElement("DIV");this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";this.Div_gen.style.width="100%";this.Div_gen.style.height="100%";this.Div_gen.style.position=this.position;this.Div_gen.style.overflowY="auto";this.Div_gen.style.overflowX="hidden";this.Div_gen.id=this.id;this.table=this.createTable();this.Div_gen.appendChild(this.table);this.rt=null;addResizeEvent(this.Div_gen,function(){oThis.paint();});if (this.parentOwner) this.placeIn(this.parentOwner);};function resizeLayout(compId){alert("resizeLayout");};FixedGridLayout.prototype.paint=function(){var oThis=this;if(this.labelPosition=='top'){this.labelMaxWidth=this.parentOwner.offsetWidth/this.columnCount-15;}else{if (IS_IPAD) this.labelMaxWidth=this.parentOwner.offsetWidth/this.columnCount-this.defaultwidth-18;else this.labelMaxWidth=this.parentOwner.offsetWidth/this.columnCount-this.defaultwidth-15;}if(this.labelMaxWidth<20){this.labelMaxWidth=20;}var compsCount=this.comps.length;if (compsCount==0) return;var offsetWidth=this.Div_gen.offsetWidth;if (offsetWidth==0) return;if (this.renderType==5){var lableWidth=(parseInt(offsetWidth)/parseInt(this.columnCount))-parseInt(this.basewidth)-15;if (lableWidth>0) this.fixedLabelWidth=lableWidth;}var visibleComps=[],hiddenComps=[],allComps=this.comps;for ( var i=0;i<compsCount;i++){if (allComps[i].visible==true){visibleComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="block";if(typeof(allComps[i].show)=="function"){allComps[i].show();}}else{hiddenComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="none";if(typeof(allComps[i].hide)=="function"){allComps[i].hide();}}}this.comps=visibleComps;this.Div_gen.removeChild(this.table);this.table=this.createTable();this.table.style.margin="0px auto";if (IS_IE8) this.table.style.overflowY="hidden";this.Div_gen.appendChild(this.table);var nowRow=0;var count=0;var rowIndex=0;var labels=new Array(this.columnCount);var currentRow=null;var gridGraph=new Array();for ( var i=0,compCount=this.comps.length;i<=compCount;i++){if (i==compCount){if(gridGraph[nowRow] !=null&&count==0){currentRow=this.createRow();i--;nowRow++;continue;}else{continue;}}var colSpan=this.comps[i].colSpan;var rowSpan=this.comps[i].rowSpan;if (count==0){currentRow=this.createRow();}if (gridGraph[nowRow]==null) gridGraph[nowRow]=new Array();while (gridGraph[nowRow][count] !=null){count++;}if (count>this.columnCount) count=this.columnCount;if (colSpan>this.columnCount) colSpan=this.columnCount;if (count+parseInt(colSpan)>this.columnCount){for (;count<this.columnCount;count++) this.createNullCell(currentRow);i--;count=0;nowRow++;continue;}else if(count !=0&&this.comps[i].nextLine){for (;count<this.columnCount;count++) this.createNullCell(currentRow);i--;count=0;nowRow++;continue;}else{for (var row=0;row<rowSpan;row++){if (gridGraph[row+nowRow]==null) gridGraph[row+nowRow]=new Array();for (var col=0;col<colSpan ;col++){gridGraph[row+nowRow][col+count]=1;}}var cell=this.createCell(currentRow,rowSpan,colSpan);this.renderOneElement(cell,this.comps[i],count,labels);if (this.comps[i].isAttachNext==true&&this.comps[i+1] !=null) this.renderOneElement(cell,this.comps[++i],count,labels);count+=parseInt(colSpan,10);}if (count==this.columnCount){this.createNullCell(currentRow);count=0;nowRow++;}}if (this.renderType==1) this.reSetBounds(this.comps,labels);if (IS_IE8&&currentRow !=null){var rSpan=parseInt(currentRow.getAttribute("rSpan"));for (var i=1;i<rSpan;i++){this.createRow();}}this.comps=allComps;this.afterRepaint();};FixedGridLayout.prototype.renderOneElement=function(cell,comp,count,labels){comp.colIndex=count;var table=this.createTable();table.setAttribute("width","100%");table.setAttribute("height","100%");cell.appendChild(table);if(this.labelPosition=='top'){var labelRow=table.insertRow(-1);}var row=table.insertRow(-1);if ((IS_IE8 || IS_CHROME)&&comp.rowSpan !=null&&comp.rowSpan>1){table.setAttribute("height",comp.rowSpan*this.rowHeight);}var label=comp.labelName;if (comp.componentType=="CHECKBOX") label="";var labelCell;if(this.labelPosition=='top'){labelCell=labelRow.insertCell(-1);labelCell.style.textAlign="left";}else{labelCell=row.insertCell(-1);labelCell.style.textAlign="right";labelCell.setAttribute("valign","center");}if (comp.labelColor){if(comp.labelColor=="null") comp.labelColor="";labelCell.style.color=comp.labelColor;}var innerHTML;var lableExWidth=0;if (comp.isRequired&&label !=null&&this.editable){if(IS_IE7) innerHTML='<div style="display:inline-block;overflow: hidden; white-space: nowrap; text-overflow: ellipsis; float:left;">'+label+'</div><span style="display:inline;color: red; padding-left: 3px; padding-right: 3px;">*</span>';else innerHTML='<div style="display:inline-block;overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">'+label+'</div><span style="display:inline;color: red; padding-left: 3px; padding-right: 3px;">*</span>';lableExWidth=12;if (this.fixedLabelWidth) lableExWidth=14;}else{if(comp.warnIcon){comp.warnIcon.style.display="none";}innerHTML="<div style='margin-right:10px;overflow: hidden; white-space: nowrap; text-overflow: ellipsis;'>"+getString(label,"")+"</div>";lableExWidth=10;}labelCell.innerHTML=innerHTML;if (this.fixedLabelWidth){labelCell.style.width=this.fixedLabelWidth+"px";labelCell.firstChild.style.width=this.fixedLabelWidth-lableExWidth+"px";labelCell.title=getString(label,"");}else this.dealLabelWidth(labelCell,getString(label,""),lableExWidth,count,labels);var compCell=row.insertCell(-1);compCell.setAttribute("valign","top");compCell.appendChild(comp.Div_gen);if (IS_IE8&&comp.height=="100%"&&comp.rowSpan !=null&&comp.rowSpan>1) comp.Div_gen.style.height=comp.rowSpan*this.rowHeight+"px";if (this.renderType==1&&comp.basewidth&&comp.basewidth.indexOf('%')==-1 ){if (this.maxCompsWidth[count]==null) this.maxCompsWidth[count]=comp.basewidth;else if (this.maxCompsWidth[count]<comp.basewidth) this.maxCompsWidth[count]=comp.basewidth;}else if (this.renderType==1&&comp.basewidth&&comp.basewidth.indexOf('%') !=-1&&this.maxCompsWidth[count]==null) this.maxCompsWidth[count]=0;if (comp.inputAssistant !=null&&comp.inputAssistant !=""){var assCell=row.insertCell(-1);assCell.setAttribute("valign","top");assCell.style.textAlign="right";assCell.style.paddingTop="3px";assCell.style.paddingRight="5px";assCell.innerHTML=comp.inputAssistant;}if (comp.description !=null&&comp.description !=""){var descCell=row.insertCell(-1);descCell.setAttribute("valign","top");descCell.style.textAlign="right";descCell.style.paddingTop="3px";descCell.style.paddingRight="5px";descCell.style.color="gray";descCell.innerHTML=comp.description;}};FixedGridLayout.prototype.createTable=function(){var table=$ce("table");return table;};FixedGridLayout.prototype.createRow=function(){if (this.table==null) return;var row=this.table.insertRow(-1);row.setAttribute("height",this.rowHeight+"px");return row;};FixedGridLayout.prototype.createNullCell=function(row){if (row==null) return;var cell=row.insertCell(-1);return cell;};FixedGridLayout.prototype.createCell=function(row,rowSpan,colSpan){if (row==null) return;var cell=row.insertCell(-1);cell.setAttribute("valign","top");cell.setAttribute("rowSpan",rowSpan);cell.setAttribute("colSpan",colSpan);var rSpan=row.getAttribute("rSpan");if (rSpan==null || rowSpan>rSpan) row.setAttribute("rSpan",rowSpan);return cell;};FixedGridLayout.prototype.addComp=function(cell,comp){var labelDiv=$ce("DIV");labelDiv.style.textAlign="right";if (IS_IE) labelDiv.style.styleFloat="left";else labelDiv.style.cssFloat="left";labelDiv.style.paddingTop="2px";labelDiv.style.paddingRight="5px";labelDiv.style.width="44px";labelDiv.value=comp.labelName;cell.appendChild(labelDiv);var objHtml=comp.getObjHtml();cell.appendChild(objHtml);comp.parentOwner=cell;};FixedGridLayout.prototype.afterRepaint=function(){this.Div_gen.style.height="100%";};FixedGridLayout.prototype.getHeight=function(){if (this.table==null) return 0;var height=(this.rowHeight+3)*this.table.rows.length;return height;};FixedGridLayout.prototype.add=function(comp){PanelComp.prototype.add.call(this,comp);this.comps.push(comp.owner);};FixedGridLayout.prototype.setForceRepaint=function(isForceRepaint){this.forceRepaint=getBoolean(isForceRepaint,false);};FixedGridLayout.prototype.getComps=function(){return this.comps;};FixedGridLayout.prototype.getCompById=function(id){if (this.comps !=null){for ( var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id) return this.comps[i];}}};FixedGridLayout.prototype.removeCompById=function(id){var comp=null;if (this.comps !=null){var newComps=new Array();for ( var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id){comp=this.comps[i];}else{newComps.push(this.comps[i])}}this.comps=newComps;}return comp;};FixedGridLayout.prototype.dealLabelWidth=function(labelDiv,label,lableExWidth,count,labels){var currentWidth=getTextWidth(label,null);currentWidth+=parseInt(lableExWidth);if (currentWidth>this.labelMaxWidth){currentWidth=parseInt(this.labelMaxWidth);}if (labels[count]==null){labels[count]=new Array();}if (this.maxLabelWidth[count]==null) this.maxLabelWidth[count]=currentWidth;if (this.maxLabelWidth[count]<currentWidth){for (var i=0;i<labels[count].length;i++){labels[count][i].style.width=currentWidth+"px";}this.maxLabelWidth[count]=currentWidth;}labelDiv.style.width=this.maxLabelWidth[count]+"px";labelDiv.title=label;labelDiv.firstChild.style.width=this.maxLabelWidth[count]-lableExWidth+"px";labels[count].push(labelDiv);};FixedGridLayout.prototype.reSetBounds=function(comps,lables){for (var i=0;i<comps.length;i++){if (comps[i].basewidth&&comps[i].basewidth.indexOf('%')==-1) continue;var colIndex=comps[i].colIndex;var colSpan=getInteger(comps[i].colSpan,0);var compWidth=(this.maxCompsWidth[colIndex]==null || this.maxCompsWidth[colIndex]==0) ? this.basewidth*colSpan:this.maxCompsWidth[colIndex];for (var j=1;j<colSpan;j++){var nextCompWidth=this.maxCompsWidth[colIndex+j]==null ? 0:this.maxCompsWidth[colIndex+j];var nextLabelWidth=this.maxLabelWidth[colIndex+j]==null ? 0:this.maxLabelWidth[colIndex+j];var colWidth=parseInt(nextCompWidth)+parseInt(nextLabelWidth);if (colWidth>0) colWidth=parseInt(colWidth)+6;compWidth=parseInt(compWidth)+parseInt(colWidth)+8;}if (comps[i].componentType=="TEXTAREA"&&IS_IE8){comps[i].setBounds(0,0,compWidth,null);}else{comps[i].setBounds(0,0,compWidth,comps[i].height);}}};
FlowGridLayout.prototype.className="FlowGridLayout";FlowGridLayout.prototype=new PanelComp;FlowGridLayout.BASEWIDTH=120;FlowGridLayout.COLSPACE=21;FlowGridLayout.ROWSPACE=6;FlowGridLayout.COMPHEIGHT=22;function FlowGridLayout(parent,name,left,top,width,height,position,scroll,compDefaultWidth,marginTop,form){this.base=PanelComp;this.base(parent,name,left,top,width,height,position,scroll);this.parentOwner=parent;this.defaultwidth=getInteger(compDefaultWidth,FlowGridLayout.BASEWIDTH);this.basewidth=this.defaultwidth;this.gridWidth=0;this.colmNum=0;this.lastX=0;this.wordsdefault=5;this.comps=new Array();this.nowPaintWidth=0;this.nowPaintHeight=0;this.marginTop=getInteger(marginTop,6);this.forceRepaint=false;if (FlowGridLayout.syncArray==null){FlowGridLayout.syncArray=new Array;}FlowGridLayout.syncArray.push(this);if (FlowGridLayout.wordArray==null) FlowGridLayout.wordArray=new Array;FlowGridLayout.COMPHEIGHT=getCssHeight("text_form_div_COMPHEIGHT");this.labelPosition="left";this.form=form;};FlowGridLayout.prototype.create=function(){var oThis=this;this.Div_gen=document.createElement("DIV");this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";if (this.width.toString().indexOf("%")==-1) this.Div_gen.style.width=this.width+"px";else this.Div_gen.style.width=this.width;if (this.height.toString().indexOf("%")==-1) this.Div_gen.style.height=this.height+"px";else this.Div_gen.style.height=this.height;this.Div_gen.style.position=this.position;if(this.overflow !=null) this.Div_gen.style.overflowY=this.overflow;if(!IS_CHROME&&!IS_SAFARI){this.Div_gen.style.overflowX="auto";}this.rt=null;addResizeEvent(this.Div_gen,function(){FlowGridLayout.resize(oThis.id);});if (this.parentOwner) this.placeIn(this.parentOwner);};FlowGridLayout.resize=function(id){var layout=window.objects[id];try{layout.paint(true);}catch(e){}};function resizeLayout(compId){var layout=objects[compId];layout.paint();};FlowGridLayout.prototype.paint=function(isForce){var oThis=this;var compsCount=this.comps.length;if (compsCount==0) return;var offsetWidth=this.Div_gen.offsetWidth;if (offsetWidth==0) return;if (this.forceRepaint==false&&(isForce==null || isForce==false)){if (offsetWidth==this.nowPaintWidth) return;}this.nowPaintWidth=offsetWidth;var visibleComps=[],hiddenComps=[],allComps=this.comps;for (var i=0;i<compsCount;i++){if (allComps[i].visible==true){visibleComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="block";if(typeof(allComps[i].show)=="function"){allComps[i].show();}}else{hiddenComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="none";if(typeof(allComps[i].hide)=="function"){allComps[i].hide();}}}this.comps=visibleComps;this.compHeight=this.getCompsHeight();this.gridPanel();this.lastCompTotalWidth=0;var rowNumTemp=0;for (var i=0,compCount=this.comps.length;i<compCount;i++){var colNum=this.comps[i].colNum;var rowNum=this.comps[i].rowNum;if("CHECKBOX"==this.comps[i].componentType){rowNumTemp+=1;}var compColNum=this.getColmNum(this.comps[i]);var labelWidth=FlowGridLayout.wordArray[colNum];var compWidth=0;for (var k=colNum,count1=colNum+compColNum;k<count1;k++) compWidth=compWidth+this.realColmWidth[k];if(this.labelPosition !='top'){compWidth=compWidth-labelWidth;}var usedWidth=0;if (colNum !=0){for (var j=0;j<colNum;j++) usedWidth+=this.realColmWidth[j];if(this.labelPosition=='top'){usedWidth-=50*colNum;}}var top=0;if(this.labelPosition=='top'){top=(rowNum*2-rowNumTemp)*(FlowGridLayout.COMPHEIGHT)+(rowNum*10);}else{top=this.marginTop+rowNum*(FlowGridLayout.COMPHEIGHT+FlowGridLayout.ROWSPACE);}var left=0;if(this.labelPosition=='top'){left=usedWidth;}else{left=usedWidth+FlowGridLayout.COLSPACE-6;}if (this.comps[i].attachedLabel !=null){this.comps[i].attachedLabel.style.left=left+"px";this.comps[i].attachedLabel.style.top=top+"px";this.comps[i].attachedLabel.style.display="block";var attachedLabelWidth=FlowGridLayout.getLabelDivWidth(labelWidth);if(this.ellipsis==true&&this.comps[i].Div_text&&attachedLabelWidth>this.comps[i].Div_text.offsetWidth){attachedLabelWidth=this.comps[i].Div_text.offsetWidth;}this.comps[i].attachedLabel.style.width=attachedLabelWidth+"px";var htmlStr=null;if (this.comps[i].isRequired){if (this.labelPosition=='top'){htmlStr="<div "+(this.comps[i].componentType=="CHECKBOX"? "":"title='"+this.comps[i].labelName+"' ")+(this.ellipsis==true?"class='div_label_ellipsis' ":"")+"style='overflow: hidden; white-space: nowrap; text-overflow: ellipsis;position:relative;float:left;'>"+(this.comps[i].componentType=="CHECKBOX"? "":this.comps[i].labelName)+"</div>"+"<span style='color:red;margin-left:3px;margin-right:3px;'>*</span>";}else{htmlStr="<div "+(this.comps[i].componentType=="CHECKBOX"? "":"title='"+this.comps[i].labelName+"' ")+(this.ellipsis==true?"class='div_label_ellipsis' ":"")+"style='overflow: hidden; white-space: nowrap; text-overflow: ellipsis;position:relative;float:left;width:"+(attachedLabelWidth-12)+"px;'>"+(this.comps[i].componentType=="CHECKBOX"? "":this.comps[i].labelName)+"</div>"+"<span style='color:red;margin-left:3px;margin-right:3px;'>*</span>";}}else{if(this.comps[i].warnIcon){this.comps[i].warnIcon.style.display="none";}htmlStr="<div "+(this.comps[i].componentType=="CHECKBOX"? "":"title='"+this.comps[i].labelName+"' ")+(this.ellipsis==true?"class='div_label_ellipsis' ":"")+"style='overflow: hidden; white-space: nowrap; text-overflow: ellipsis;position:relative;margin-right:10px;'>"+(this.comps[i].componentType=="CHECKBOX"? "":this.comps[i].labelName)+"</div>";}this.comps[i].attachedLabel.innerHTML=htmlStr;}else{var attachedLabel=this.createLabel(this.comps[i],usedWidth,top,labelWidth);this.comps[i].attachedLabel=attachedLabel;this.Div_gen.appendChild(attachedLabel);}if(this.labelPosition=='top'){this.comps[i].attachedLabel.style.textAlign="left";}if (window.editMode){if (this.comps[i].attachedLabel !=null){new EditableListener(this.comps[i].attachedLabel,this.comps[i].params,EditableListener.COMPOMENT_TYPE);}}var tmpCompHeight=FlowGridLayout.COMPHEIGHT*this.comps[i].rowSpan+FlowGridLayout.ROWSPACE*(this.comps[i].rowSpan-1);var compLeft=0;if(this.labelPosition=='top'){compLeft=usedWidth;top=(rowNum*2-rowNumTemp)*(FlowGridLayout.COMPHEIGHT)+(rowNum*10)+FlowGridLayout.COMPHEIGHT;compWidth=this.nowPaintWidth;}else{compLeft=usedWidth+labelWidth+FlowGridLayout.COLSPACE-6;top=this.marginTop+rowNum*(FlowGridLayout.COMPHEIGHT+FlowGridLayout.ROWSPACE);if (this.comps[i].basewidth.toString().indexOf("%") !=-1) compWidth=compWidth*parseFloat(this.comps[i].basewidth)/100 ;else compWidth=this.comps[i].basewidth>compWidth ? compWidth:this.comps[i].basewidth;}this.comps[i].setBounds(compLeft,top,compWidth,tmpCompHeight);}this.oldLabels=this.labels;this.labels=[];this.comps=allComps;this.forceRepaint=false;this.afterRepaint();needRePaint=0;for (var i=0,compCount=this.comps.length;i<compCount;i++){if(this.comps[i].componentType=="RADIOGROUP"&&this.comps[i].getObjHtml().firstChild.offsetHeight){var oldRowSpan=this.comps[i].rowSpan;var compHeight=this.comps[i].getObjHtml().firstChild.offsetHeight;var newRowSpan=parseInt(compHeight/FlowGridLayout.COMPHEIGHT);if(newRowSpan<1){newRowSpan=1;}if(oldRowSpan !=newRowSpan){this.comps[i].rowSpan=newRowSpan;needRePaint++;}}if(this.comps[i].componentType=="CHECKBOXGROUP"){var a=this.comps[i].getObjHtml();if(this.comps[i].componentType=="CHECKBOXGROUP"&&this.comps[i].getObjHtml().firstChild.offsetHeight){var oldRowSpan=this.comps[i].rowSpan;var compHeight=this.comps[i].getObjHtml().firstChild.offsetHeight;var newRowSpan=parseInt(compHeight/FlowGridLayout.COMPHEIGHT);if(newRowSpan<1){newRowSpan=1;}if(oldRowSpan !=newRowSpan){this.comps[i].rowSpan=newRowSpan;needRePaint++;}}}}if(needRePaint>0){this.paint(isForce);}else{}};FlowGridLayout.prototype.afterRepaint=function(){};FlowGridLayout.prototype.getHeight=function(){if (this.comps==null || this.comps.length==0) return 0;var comp;var maxHeight=0;for (var i=this.comps.length-1;i>=0;i--){if (this.comps[i].visible !=false){comp=this.comps[i];var height=comp.getObjHtml().offsetHeight+comp.getObjHtml().offsetTop+5;if (height>maxHeight) maxHeight=height;}}return maxHeight;};FlowGridLayout.prototype.add=function(comp){PanelComp.prototype.add.call(this,comp);this.comps.push(comp.owner);};FlowGridLayout.prototype.setForceRepaint=function(isForceRepaint){this.forceRepaint=getBoolean(isForceRepaint,false);};FlowGridLayout.prototype.getComps=function(){return this.comps;};FlowGridLayout.prototype.getCompById=function(id){if (this.comps !=null){for (var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id) return this.comps[i];}}};FlowGridLayout.prototype.removeCompById=function(id){var comp=null;if (this.comps !=null){var newComps=new Array();for (var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id){comp=this.comps[i];}else{newComps.push(this.comps[i]);}}this.comps=newComps;}return comp;};FlowGridLayout.prototype.getMaxNameWidth=function(){var comps=this.comps;var maxLength=0;for (var i=0;i<comps.length;i++){if(window.editMode){var nowLength=comps[i].labelName.lengthb()*6;}else{var nowLength=getTextWidth(comps[i].labelName,this.className);}if (nowLength>maxLength) maxLength=nowLength;}return maxLength;};FlowGridLayout.prototype.getCompNameWidth=function(comp){if (comp.componentType=="CHECKBOX"){return 0;}else{if(window.editMode){return comp.labelName.lengthb()*6;}else{return getTextWidth(comp.labelName,this.className);}}};FlowGridLayout.prototype.getCompsHeight=function(){return 22;};FlowGridLayout.prototype.getAllCompsWidth=function(comps){var allWidth=new Array(comps.length);for (var i=0;i<comps.length;i++) allWidth[i]=comps[i].getCompWidth();return allWidth;};FlowGridLayout.prototype.getColmNum=function(comp){if (comp.colSpan==-1) return this.colmNum;var cols=parseInt(comp.colSpan);return cols>this.colmNum ? this.colmNum:cols;};FlowGridLayout.prototype.gridPanel=function(sNum){this.basewidth=this.defaultwidth;if (sNum) this.colmNum=sNum;else{var offsetWidth=this.Div_gen.offsetWidth;offsetWidth=offsetWidth>15 ? offsetWidth-15:0;this.colmNum=Math .floor(offsetWidth/(this.basewidth+this.getMaxNameWidth()+FlowGridLayout.COLSPACE+15));if (this.colmNum<1 ) this.colmNum=1;}FlowGridLayout.colmNum=this.colmNum;this.realColmWidth=new Array(this.colmNum);if (!this.colmWordMaxWidth) this.colmWordMaxWidth=new Array(this.colmNum);if(this.labelPosition=='top'){var labelMaxWidth=Math.floor(this.Div_gen.offsetWidth/this.colmNum-FlowGridLayout.COLSPACE-15);}else{var labelMaxWidth=Math.floor(this.Div_gen.offsetWidth/this.colmNum-this.basewidth-FlowGridLayout.COLSPACE-15);}var colm=new Array(this.colmNum);for (var i=0,count=this.colmNum;i<count;i++) colm[i]=new Array();var temp=0;var rowNum=0;for (var i=0,count=this.comps.length;i<count;i++){var comp=this.comps[i];if (comp.nextLine&&temp !=0){temp=0;rowNum++;}var colSpan=this.getColmNum(comp);var rowSpan=comp.rowSpan;if (colSpan==1){while (colm[temp]&&colm[temp][rowNum] !=null){if (comp.nextLine){temp=0;rowNum++;}else{if (temp<this.colmNum-1){temp++;}else{temp=0;rowNum++;}}}}else if (colSpan>1){while (FlowGridLayout.checkPosition(colSpan,colm,temp,rowNum)==false){if (temp+colSpan<=this.colmNum) temp++;else{temp=0;rowNum++;}}}var labelWidth=this.getCompNameWidth(comp);if(labelWidth>labelMaxWidth){labelWidth=labelMaxWidth;}if (colm[temp] !=null){colm[temp][rowNum]=labelWidth+FlowGridLayout.COLSPACE;if (colSpan>1){for (var j=1;j<colSpan;j++){colm[temp+j][rowNum]=0;}}if (rowSpan>1){for (var j=1;j<rowSpan;j++){colm[temp][rowNum+j]=labelWidth+FlowGridLayout.COLSPACE;if (colSpan>1){for (var k=1;k<colSpan;k++){colm[temp+k][rowNum+j]=0;}}}}comp.rowNum=rowNum;comp.colNum=temp;}temp=temp+parseInt(colSpan);if (temp>this.colmNum-1){temp=0;rowNum++;}}for (var i=0,count=this.colmNum;i<count;i++){this.colmWordMaxWidth[i]=0;for (var j=0,count1=colm[i].length;j<count1;j++){if (colm[i][j]>this.colmWordMaxWidth[i]) this.colmWordMaxWidth[i]=colm[i][j];}if (FlowGridLayout.wordArray[i]==null || FlowGridLayout.wordArray[i]<this.colmWordMaxWidth[i]){FlowGridLayout.wordArray[i]=this.colmWordMaxWidth[i];}this.colmWordMaxWidth[i]=FlowGridLayout.wordArray[i];}if (FlowGridLayout.wordArray.length>this.colmNum){for (var i=FlowGridLayout.wordArray.length-1;i>=this.colmNum;i--){FlowGridLayout.wordArray.remove(i);}}var totalCalc=0;for (var i=0,count=this.colmNum;i<count;i++){totalCalc+=this.colmWordMaxWidth[i];}var offsetWidth=this.Div_gen.offsetWidth-15;if (this.Div_gen.scrollHeight>this.Div_gen.offsetHeight){offsetWidth-=17;}var remainSpace=offsetWidth-(this.basewidth+FlowGridLayout.COLSPACE)*this.colmNum+FlowGridLayout.COLSPACE-totalCalc;if (remainSpace<0&&this.colmNum>1){this.gridPanel(this.colmNum-1);return;}this.basewidth=this.defaultwidth+Math.floor(remainSpace/this.colmNum);for (var i=0,count=this.colmNum;i<count;i++){this.realColmWidth[i]=this.colmWordMaxWidth[i]+this.basewidth;}};FlowGridLayout.checkPosition=function(colSpan,colm,colNum,rowNum){for (var i=0;i<colSpan;i++){try{if (colm[colNum+i][rowNum] !=null) return false;}catch (error){return false;}}return true;};FlowGridLayout.syncAllLayouts=function(){var syncArray=FlowGridLayout.syncArray;for (var i=0;i<syncArray.length;i++){syncArray[i].sync();}};FlowGridLayout.prototype.sync=function(){var wordArray=FlowGridLayout.wordArray;var needSync=false;if (this.colmWordMaxWidth==null) return;for (var i=0;i<this.colmNum;i++){if (wordArray[i]>this.colmWordMaxWidth[i]){needSync=true;break;}}if (needSync){this.paint(true);}};FlowGridLayout.getLabelDivWidth=function(width){return parseInt(width,10)-0;};FlowGridLayout.prototype.createLabel=function(comp,left,top,width){var divLabel=document.createElement("div");divLabel.style.textAlign="right";divLabel.style.position="absolute";if (width<=0) width=20;var divLabelWidth=FlowGridLayout.getLabelDivWidth(width);if(this.ellipsis==true&&comp.Div_text&&divLabelWidth>comp.Div_text.offsetWidth){divLabelWidth=comp.Div_text.offsetWidth;}divLabel.style.width=divLabelWidth+"px";divLabel.style.overflow="hidden";divLabel.style.height=this.compHeight+"px";divLabel.style.left=(left+FlowGridLayout.COLSPACE-6)+"px";divLabel.style.top=top+"px";divLabel.style.lineHeight=this.compHeight+"px";divLabel.style.whiteSpace="nowrap";var htmlStr=null;if (comp.isRequired){htmlStr="<div  "+(comp.componentType=="CHECKBOX"? "":"title='"+comp.labelName+"' ")+(this.ellipsis==true?"class='div_label_ellipsis' ":"")+"style='overflow: hidden; white-space: nowrap; text-overflow: ellipsis;position:relative;float:left;width:"+(divLabelWidth-12)+"px;'>"+(comp.componentType=="CHECKBOX"? "":comp.labelName)+"</div>"+"<span style='color:red;margin-left:3px;margin-right:3px;'>*</span>";}else{if(comp.warnIcon){comp.warnIcon.style.display="none";}htmlStr="<div "+(comp.componentType=="CHECKBOX"? "":"title='"+comp.labelName+"' ")+(this.ellipsis==true?"class='div_label_ellipsis' ":"")+"style='overflow: hidden; white-space: nowrap; text-overflow: ellipsis;position:relative;margin-right:10px;'>"+(comp.componentType=="CHECKBOX"? "":comp.labelName)+"</div>";}if (comp.labelColor) divLabel.style.color=comp.labelColor;divLabel.innerHTML=htmlStr;return divLabel;};
ReadGridLayout.prototype.className="ReadGridLayout";ReadGridLayout.prototype=new PanelComp;ReadGridLayout.SPACE_HEIGHT=10;function ReadGridLayout(parent,name,left,top,width,height,position,scroll,compDefaultWidth,marginTop,rowHeight,columnCount,renderType,form){this.base=PanelComp;this.base(parent,name,left,top,width,height,position,scroll);this.parentOwner=parent;this.defaultwidth=getString(compDefaultWidth,"120");this.basewidth=this.defaultwidth;this.gridWidth=0;this.colmNum=0;this.lastX=0;this.wordsdefault=5;this.comps=new Array();this.marginTop=getInteger(marginTop,6);this.currentRow=null;this.rowHeight=getInteger(rowHeight,22);this.columnCount=getInteger(columnCount,2);this.maxCellsWidth=new Array(this.columnCount);this.maxCompsWidth=new Array(this.columnCount);this.maxLabelWidth=new Array(this.columnCount);this.forceRepaint=false;if (ReadGridLayout.syncArray==null){ReadGridLayout.syncArray=new Array;}ReadGridLayout.syncArray.push(this);if (ReadGridLayout.wordArray==null) ReadGridLayout.wordArray=new Array;ReadGridLayout.COMPHEIGHT=getCssHeight("text_form_div_COMPHEIGHT");this.labelPosition="left";this.renderType=renderType==null ? DefaultFormRender:renderType;this.form=form;};ReadGridLayout.prototype.create=function(){var oThis=this;this.Div_gen=document.createElement("DIV");this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";this.Div_gen.style.width="100%";this.Div_gen.style.height="100%";this.Div_gen.style.position=this.position;this.Div_gen.style.overflowY="auto";this.Div_gen.style.overflowX="hidden";this.table=this.createTable();this.Div_gen.appendChild(this.table);this.rt=null;if (this.parentOwner) this.placeIn(this.parentOwner);};function resizeLayout(compId){alert("resizeLayout");};ReadGridLayout.prototype.paint=function(){var oThis=this;var compsCount=this.comps.length;if (compsCount==0) return;var offsetWidth=this.Div_gen.offsetWidth;if (offsetWidth==0) return;var visibleComps=[],hiddenComps=[],allComps=this.comps;for ( var i=0;i<compsCount;i++){if (allComps[i].visible==true){visibleComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="block";if(typeof(allComps[i].show)=="function"){allComps[i].show();}}else{hiddenComps.push(allComps[i]);var label=allComps[i].attachedLabel;if (label&&label !=null) label.style.display="none";if(typeof(allComps[i].hide)=="function"){allComps[i].hide();}}}this.comps=visibleComps;this.Div_gen.removeChild(this.table);this.table=this.createTable();this.table.style.margin="0px auto";this.Div_gen.appendChild(this.table);var nowRow=0;var count=0;var rowIndex=0;var columnCounts=this.columnCount*2;var labels=new Array(columnCounts);var currentRow=null;var gridGraph=new Array();for ( var i=0,compCount=this.comps.length;i<=compCount;i++){if (i==compCount){if(gridGraph[nowRow] !=null&&count==0){currentRow=this.createRow();i--;nowRow++;continue;}else{continue;}}var colSpan=this.comps[i].colSpan;var rowSpan=this.comps[i].rowSpan;if (count==0){currentRow=this.createRow();}if (gridGraph[nowRow]==null) gridGraph[nowRow]=new Array();while (gridGraph[nowRow][count] !=null){count++;}if (count>columnCounts-1) count=columnCounts-1;if (colSpan>columnCounts-1) colSpan=columnCounts-1;if (count+parseInt(colSpan)+1>(columnCounts)){for (;count<columnCounts;count++) this.createNullCell(currentRow);i--;count=0;nowRow++;continue;}else if(count !=0&&this.comps[i].nextLine){for (;count<columnCounts;count++) this.createNullCell(currentRow);i--;count=0;nowRow++;continue;}else{for (var row=0;row<rowSpan;row++){if (gridGraph[row+nowRow]==null) gridGraph[row+nowRow]=new Array();for (var col=0;col<colSpan ;col++){gridGraph[row+nowRow][col+count]=1;}}var labelCell=null;if (this.comps[i].editorType !=EditorType.IMAGECOMP){labelCell=this.createCell(currentRow,rowSpan,'1');}var valueCell=this.createCell(currentRow,rowSpan,colSpan);this.renderOneElement(labelCell,valueCell,this.comps[i],count,labels,this.table,currentRow);count+=parseInt(colSpan,10);count++;}if (count==columnCounts){count=0;nowRow++;}}this.comps=allComps;if(count<columnCounts&&count !=0){var col=(columnCounts-count) ;var tmpCell=this.createCell(currentRow,rowSpan,col);}this.afterRepaint();if(this.form){if(this.form.focusComp){if(this.form.focusComp.setFocus){setTimeout(function(){oThis.form.focusComp.setFocus();},200);}}}};ReadGridLayout.prototype.renderOneElement=function(labelCell,valueCell,comp,count,labels,table,row){comp.labelCell=labelCell;comp.valueCell=valueCell;comp.row=row;comp.table=table;comp.colIndex=count;this.renderType.call(this,comp,labelCell,valueCell,table,row);};ReadGridLayout.prototype.createTable=function(){var table=$ce("table");return table;};ReadGridLayout.prototype.createRow=function(){if (this.table==null) return;var row=this.table.insertRow(-1);row.setAttribute("height",this.rowHeight+"px");return row;};ReadGridLayout.prototype.createNullCell=function(row){if (row==null) return;var cell=row.insertCell(-1);return cell;};ReadGridLayout.prototype.createCell=function(row,rowSpan,colSpan){if (row==null) return;var cell=row.insertCell(-1);cell.setAttribute("valign","top");cell.setAttribute("rowSpan",rowSpan);cell.setAttribute("colSpan",colSpan);var rSpan=row.getAttribute("rSpan");if (rSpan==null || rowSpan>rSpan) row.setAttribute("rSpan",rowSpan);return cell;};ReadGridLayout.prototype.addComp=function(cell,comp){var labelDiv=$ce("DIV");labelDiv.style.textAlign="right";if (IS_IE) labelDiv.style.styleFloat="left";else labelDiv.style.cssFloat="left";labelDiv.style.paddingTop="2px";labelDiv.style.paddingRight="5px";labelDiv.style.width="44px";labelDiv.value=comp.labelName;cell.appendChild(labelDiv);var objHtml=comp.getObjHtml();cell.appendChild(objHtml);comp.parentOwner=cell;};ReadGridLayout.prototype.afterRepaint=function(){this.Div_gen.style.height="100%";};ReadGridLayout.prototype.getHeight=function(){if (this.table==null) return 0;var height=(this.rowHeight+3)*this.table.rows.length;return height;};ReadGridLayout.prototype.add=function(comp){this.comps.push(comp);};ReadGridLayout.prototype.setForceRepaint=function(isForceRepaint){this.forceRepaint=getBoolean(isForceRepaint,false);};ReadGridLayout.prototype.getComps=function(){return this.comps;};ReadGridLayout.prototype.getCompById=function(id){if (this.comps !=null){for ( var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id) return this.comps[i];}}};ReadGridLayout.prototype.removeCompById=function(id){var comp=null;if (this.comps !=null){var newComps=new Array();for ( var i=0,count=this.comps.length;i<count;i++){if (this.comps[i].id==id){comp=this.comps[i];}else{newComps.push(this.comps[i])}}this.comps=newComps;}return comp;};ReadGridLayout.prototype.reSetBounds=function(comps,lables){for (var i=0;i<comps.length;i++){if (comps[i].basewidth.indexOf('%')==-1) continue;var colIndex=comps[i].colIndex;var colSpan=comps[i].colSpan;var compWidth=(this.maxCompsWidth[colIndex]==null || this.maxCompsWidth[colIndex]==0) ? this.basewidth*colSpan:this.maxCompsWidth[colIndex];for (var j=1;j<colSpan;j++){var nextCompWidth=this.maxCompsWidth[colIndex+j]==null ? 0:this.maxCompsWidth[colIndex+j];var nextLabelWidth=this.maxLabelWidth[colIndex+j]==null ? 0:this.maxLabelWidth[colIndex+j];var colWidth=parseInt(nextCompWidth)+parseInt(nextLabelWidth);if (colWidth>0) colWidth=parseInt(colWidth)+6;compWidth=parseInt(compWidth)+parseInt(colWidth)+8;}if (comps[i].componentType=="TEXTAREA"&&IS_IE8){comps[i].setBounds(0,0,compWidth,null);}else{comps[i].setBounds(0,0,compWidth,comps[i].height);}}};ReadElement.prototype=new ListenerUtil;function ReadElement(form,eleId,layout,width,height){this.id=eleId;this.form=form;this.layout=layout;this.layout.add(this);this.editorType=null;this.attr=null;this.visible=true;this.width=width ? width:"100%";this.height=height;ListenerUtil.call(this,true);};ReadElement.prototype.setEditorType=function(editorType){this.editorType=editorType;this.createFuncByType();};ReadElement.prototype.getEditorType=function(){return this.editorType;};ReadElement.prototype.createFuncByType=function(){var oThis=this;if (isNull(this.editorType)) return;if (this.editorType==EditorType.IMAGECOMP){this.setValue=function(value){oThis.value=value;if (oThis.valueCell){oThis.valueCell.innerHTML="";oThis.changeImage(oThis.valueCell);oThis.layout.renderType.call(oThis,oThis,oThis.labelCell,oThis.valueCell,oThis.table,oThis.row);}};this.changeImage=function(valueCell){var row=null;if(oThis.form.dataset) row=oThis.form.dataset.getSelectedRow();if (row==null){oThis.img=$ce("IMG");oThis.img.src="";oThis.img.setAttribute("width",oThis.width);valueCell.appendChild(oThis.img);return;}var pkValue=row.getCellValue(oThis.form.dataset.nameToIndex(oThis.attr.pkfield));if (pkValue !=null){var url=oThis.attr.url.replace("$REPLACE$",pkValue);oThis.img=$ce("IMG");oThis.img.src=url;oThis.img.setAttribute("width",oThis.width);valueCell.appendChild(oThis.img);return;}if (!isNull(oThis.value)){var url=getFileService().execute("getDownUrl","$S_"+oThis.value,"$S_"+oThis.attr.sysid);oThis.img=$ce("IMG");oThis.img.setAttribute("width",oThis.width);oThis.img.src=url;valueCell.appendChild(oThis.img);return;}};}else if(this.editorType==EditorType.FILECOMP){this.setValue=function(value){if (isNull(value))return;oThis.value=value;if (oThis.valueCell){oThis.valueCell.innerHTML="";if (oThis.value !=null&oThis.value !=""){if (oThis.value.indexOf(",") !=-1) oThis.multValue=true;if (oThis.value.indexOf(FileComp.FILE_PK) !=-1) oThis.containFilePk=true;}oThis.createFileList(oThis.valueCell);oThis.layout.renderType.call(oThis,oThis,oThis.labelCell,oThis.valueCell,oThis.table,oThis.row);}};this.createFileList=function(valueCell,pFiles){if (oThis.value==null || oThis.value=="") return;else{oThis.files=pFiles;if (oThis.files==null){if(oThis.attr.sysid==null || oThis.attr.sysid=="") oThis.attr.sysid="bafile";if (oThis.attr.sysid !=null&&oThis.attr.sysid !="") oThis.files=getFileService().execute("getFiles","$S_"+oThis.value,"$S_"+oThis.attr.sysid);else oThis.files=getFileService().execute("getFiles","$S_"+oThis.value);}if (oThis.files !='[]'){var maxWidth=valueCell.offsetWidth-50-16;maxWidth=maxWidth>0 ? maxWidth:0;for (var i=0;i<oThis.files.length;i++){oThis.createFileElement(oThis.files[i],maxWidth);}}}};this.createFileElement=function(file,maxWidth){if (file=="") return;var fileDiv=$ce("DIV");fileDiv.style.overflowY="auto";file=eval("("+file+")");var fileName=file.name;var typeImg=$ce("IMG");typeImg.style[ATTRFLOAT]="left";typeImg.src=this.getTypeImgSrc(file.type);fileDiv.appendChild(typeImg);var textDiv=$ce("DIV");textDiv.style[ATTRFLOAT]="left";textDiv.style.marginRight="10px";textDiv.style.marginLeft="10px";if (maxWidth !=null&&maxWidth>0){textDiv.style.width=maxWidth+"px";textDiv.style.overflow="hidden";textDiv.style.textOverflow="ellipsis";textDiv.style.whiteSpace="nowrap";}var a=$ce("a");a.href="javascript:void(0)";if (file.filesize){var filesize=(file.filesize/1024).toFixed(2);a.innerHTML=fileName+"("+filesize+"KB)";textDiv.title=fileName+"("+filesize+"KB)";}else{a.innerHTML=fileName;textDiv.title=fileName;}a.onclick=function(e){oThis.downLoadFile(file.id);e=EventUtil.getEvent();stopAll(e);};textDiv.appendChild(a);fileDiv.appendChild(textDiv);oThis.valueCell.appendChild(fileDiv);};this.getTypeImgSrc=function(fileType){var imgPath=window.themePath+"/ui/ctrl/text/images/filetype/";for (var i=0;i<FileComp.FileTypeArray.length;i++){if (fileType.toLowerCase()==FileComp.FileTypeArray[i]){return imgPath+FileComp.FileTypeArray[i]+".gif";}}return imgPath+"unknown.gif";};this.downLoadFile=function(fileId){var url;if (oThis.attr.sysid !=null&&oThis.attr.sysid !="") url=getFileService().execute("getDownUrl","$S_"+fileId,"$S_"+oThis.attr.sysid);else url=getFileService().execute("getDownUrl","$S_"+fileId);sysDownloadFile(url);};}};ReadElement.prototype.setAttr=function(attr){this.attr=attr;if (this.attr&&this.attr.visible==false) this.visible=false;};ReadElement.prototype.getAttr=function(){return this.attr;};ReadElement.prototype.setValue=function(value){this.value=this.getValueByType(value);if (this.labelCell) this.labelCell.innerHTML="";if (this.valueCell){this.valueCell.innerHTML="";this.layout.renderType.call(this.layout,this,this.labelCell,this.valueCell,this.table,this.row);}};ReadElement.prototype.getValue=function(){return this.value;};ReadElement.prototype.getValueByType=function(value){if (isNull(this.editorType)) return value;if (this.editorType==EditorType.COMBOBOX){var nameValue="";if (!isNull(this.attr.comboData)){if(value !=null&&value !=""){var valueArr=value.split(",");for (var j=0;j<valueArr.length;j++){nameValue=nameValue+","+this.attr.comboData.getNameByValue(valueArr[j]);}}}if(nameValue.length>1){return nameValue.substring(1);}else{return nameValue;}}else if (this.editorType==EditorType.CHECKBOX){if (!isNull(this.attr.valuePair)){return value==this.attr.valuePair[0] ? trans("ml_yes"):trans("ml_no");}}else if (this.editorType==EditorType.PWDTEXT){return "●●●●●●";}else if (this.editorType==EditorType.LANGUAGECOMBOBOX){var fieldId=this.fieldId;var currentLanguageCode=pageUI.currentLanguageCode;var dataset=this.form.dataset;var row=dataset.getSelectedRow();if(row){if(currentLanguageCode !="1"){var langFieldName=fieldId+currentLanguageCode;value=row.getCellValue(dataset.nameToIndex(langFieldName));}if(isNull(value)){value=row.getCellValue(dataset.nameToIndex(fieldId));}}}return value;};ReadElement.prototype.setActive=function(){};ReadElement.prototype.setChangedContext=function(context){if (context.visible !=null) this.visible=context.visible;};ReadElement.prototype.getChangedContext=function(){return null;};ReadElement.prototype.clearChange=function(){};function DefaultFormRender(ele,labelCell,valueCell,table,row){if (table&&table.getAttribute("rendered")==null){table.setAttribute("border",1);table.setAttribute("cellpadding",0);table.setAttribute("cellspacing",0);table.setAttribute("cellspacing",0);table.setAttribute("bordercolor","#D1DFE4");table.style.borderCollapse="collapse";table.style.borderColor="#D1DFE4";table.style.wordWrap="break-word";table.style.tableLayout="fixed";table.setAttribute("rendered",1);}if(row !=null) row.setAttribute("height","29px");if (labelCell !=null){labelCell.innerHTML=ele.labelName;if(IS_IE7){labelCell.style.width=parseInt((100/ele.layout.columnCount)*0.4)+"%";}else{labelCell.style.width="153px";}labelCell.style.backgroundColor="#F7FCFF";labelCell.style.textAlign="right";labelCell.style.paddingLeft="10px";labelCell.style.paddingRight="10px";labelCell.style.verticalAlign="middle";}if (EditorType.IMAGECOMP==ele.editorType){valueCell.innerHTML="";ele.changeImage(valueCell);}else if (EditorType.FILECOMP==ele.editorType){}else if (ele.value !=null){var showValue=ele.value;var masker=getMasker(ele.editorType);if(masker !=null){showValue=toColorfulString(masker.format(showValue));}if(valueCell !=null) valueCell.innerHTML=showValue;}if(valueCell !=null){if(IS_IE7){valueCell.style.width=parseInt((100/ele.layout.columnCount)*0.6)+"%";}else{valueCell.style.width="211px";}valueCell.style.paddingLeft="10px";valueCell.style.paddingRight="10px";valueCell.style.verticalAlign="middle";if(ele.editorType==EditorType.IMAGECOMP) valueCell.style.textAlign="center";}};