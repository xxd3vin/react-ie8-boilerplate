ImageComp.prototype=new BaseComponent;ImageComp.prototype.componentType="IMAGE";function ImageComp(parent,name,refImg1,left,top,width,height,alt,refImg2,attrObj){if (arguments.length==0) return;this.base=BaseComponent;this.base(name,left,top,width,height);if (width==''|| width==null || isNaN(parseInt(width))) this.width="auto";if (height==''|| height==null || isNaN(parseInt(height))) this.height="auto";this.refImg1=getString(refImg1,window.themePath+"/ui/basic/images/transparent.gif");this.refImg2=getString(refImg2,null);this.alt=alt;this.parentOwner=parent;this.position="relative";this.disabled=false;this.visible=true;this.boolFloatRight=false;this.boolFloatLeft=false;this.inactiveImg=this.refImg1;this.canUpload=false;this.maxShow=false;if (attrObj !=null){this.position=getString(attrObj.position,this.position);this.disabled=getBoolean(attrObj.disabled,this.disabled);this.visible=getBoolean(attrObj.visible,this.visible);this.canUpload=getBoolean(attrObj.canUpload,this.canUpload);this.sysid=attrObj.sysid;this.baModule=attrObj.baModule;if (attrObj.boolFloatRight !=null&&attrObj.boolFloatRight==true){this.boolFloatRight=attrObj.boolFloatRight;this.position="relative";}if (attrObj.boolFloatLeft !=null&&attrObj.boolFloatLeft==true){this.boolFloatLeft=attrObj.boolFloatLeft;this.position="relative";}this.inactiveImg=getString(attrObj.inactiveImg,this.refImg1);this.maxShow=getBoolean(attrObj.maxShow,this.maxShow);}if(this.sysid==null) this.sysid="bafile";this.create();};ImageComp.prototype.create=function(){this.Div_gen=$ce("DIV");this.Div_gen.id=this.id;this.Div_gen.style.position=this.position;this.Div_gen.style.left=this.left+"px";this.Div_gen.style.top=this.top+"px";if(!this.visible){this.hideV();}if (this.boolFloatLeft){this.Div_gen.style[ATTRFLOAT]="left";this.Div_gen.style.styleFloat="left";}if (this.boolFloatRight){this.Div_gen.style[ATTRFLOAT]="right";this.Div_gen.style.styleFloat="right";}this.Div_gen.onselectstart=function(){return false;};if (this.parentOwner) this.placeIn(this.parentOwner);if (window.editMode !=null&&window.editMode==true){this.Div_gen.appendChild(document.createTextNode(trans("ml_image")));return;}};ImageComp.prototype.manageSelf=function(){var oThis=this;this.optionDiv=$ce("DIV");this.Div_gen.appendChild(this.optionDiv);this.optionDiv.style.position="absolute";this.optionDiv.style.bottom="0px";this.optionDiv.style.width="100%";this.optionDiv.style.textAlign="center";this.optionDiv.style.display="none";var a=$ce("a");a.style.paddingRight="10px";a.href="javascript:void(0)";a.innerHTML=trans("ml_upload_upload");a.onclick=function(e){document.onclick();oThis.uploadFile();e=EventUtil.getEvent();stopAll(e);};this.optionDiv.appendChild(a);var da=$ce("a");da.href="javascript:void(0)";da.innerHTML=trans("ml_upload_delete");da.onclick=function(e){showConfirmDialog(trans("ml_image_isDelete"),ImageComp.deleteFile,null,oThis,null,null,trans("ml_upload_delete"),trans("ml_upload_notdelete"),trans("ml_upload_delete"));e=EventUtil.getEvent();stopAll(e);};this.optionDiv.appendChild(da);this.img1=$ce("IMG");this.setImg1(this.refImg1);this.Div_gen.appendChild(this.img1);if (this.width=="auto"&&!IS_IE) this.Div_gen.style.width=this.img1.width+"px";else this.Div_gen.style.width=this.width;if (this.height=="auto"&&!IS_IE) this.Div_gen.style.height=this.img1.height+"px";else{this.Div_gen.style.height=this.height;}if(window.editMode) this.Div_gen.style.minHeight="15px";if(this.maxShow==true){this.img1.style.width="100%";this.img1.style.height="100%";}if (this.alt !=null) this.Div_gen.title=this.alt;this.img1.onerror=function (e){};if (this.refImg2 !=""){this.Div_gen.onmouseout=function(e){if (!oThis.disabled){e=EventUtil.getEvent();oThis.setImg1(oThis.refImg1);this.style.cursor="default";oThis.onmouseout(e);clearEventSimply(e);}};}this.Div_gen.onmouseover=function(e){e=EventUtil.getEvent();if (!oThis.disabled){this.style.cursor="pointer";if (oThis.refImg2){oThis.img1.src=oThis.refImg2;}}else{this.style.cursor="default";}oThis.onmouseover(e);stopEvent(e);clearEventSimply(e);};this.Div_gen.onclick=function(e){e=EventUtil.getEvent();if (!oThis.disabled){oThis.onclick(e);stopEvent(e);}clearEventSimply(e);};this.Div_gen.oncontextmenu=function(e){oThis.oncontextmenu(e);};};ImageComp.prototype.uploadFile=function(){pageUI.afterImageUpload=function(pk){if (pageUI._ImageComp !=null){pageUI._ImageComp.setValue(pk);pageUI._ImageComp=null;}};var url=window.globalPath+"/core/file.jsp?pageId=file&method=pageUI.afterImageUpload&isalert=false&multi=false&closeDialog=true";if(this.sysid !=null) url+="&sysid="+this.sysid;if(this.baModule !=null) url+="&baModule="+this.baModule;pageUI._ImageComp=this;showDialog(url,"上传图片",450,430,"file select",null,{isShowLine:false}) ;};ImageComp.deleteFile=function(imageComp){if (imageComp.refImg1==null) return;try{getFileService().execute("deleteFile","$S_"+imageComp.pk,"$S_"+imageComp.sysid);}catch(e){}imageComp.setValue("");};ImageComp.prototype.setBounds=function(left,top,width,height){this.left=getInteger(left,0);this.top=getInteger(top,0);if (width=="auto") this.width="auto";else this.width=getString(convertWidth(width),"100%");if (height=="auto") this.height="auto";else this.height=getString(convertHeight(height),"100%");this.getObjHtml().style.left=this.left+"px";this.getObjHtml().style.top=this.top+"px";this.getObjHtml().style.width=this.width;this.getObjHtml().style.height=this.height;};ImageComp.prototype.changeImage=function(src1,src2){this.refImg1=src1;this.setImg1(src1);if (this.refImg2 !='') this.refImg2=src2;};ImageComp.prototype.setImg1=function(src1){if(this.img1){this.img1.src=src1;if (isNull(src1)) this.img1.style.display="none";else this.img1.style.display="";this.img1.removeAttribute("width");this.img1.removeAttribute("height");}};ImageComp.prototype.changeAlt=function(alt){this.Div_gen.title=alt;};ImageComp.prototype.setActive=function(isActive){var isActive=getBoolean(isActive,false);if (this.disabled==false&&isActive==false){this.mouseoutFunc=this.Div_gen.onmouseout;this.mouseoverFunc=this.Div_gen.onmouseover;this.clickFunc=this.Div_gen.onclick;if (this.Div_gen.ondblclick) this.dbclickFunc=this.Div_gen.ondblclick;this.contextmenuFunc=this.Div_gen.oncontextmenu;this.Div_gen.onmouseout=function(){};this.Div_gen.onmouseover=function(){};this.Div_gen.ondblclick=function(){};this.Div_gen.onclick=function(){};this.Div_gen.oncontextmenu=function(){};this.disabled=true;this.setImg1(this.inactiveImg);this.optionDiv.style.display="none";}else if (this.disabled==true&&isActive==true){if (this.mouseoutFunc) this.Div_gen.onmouseout=this.mouseoutFunc;if (this.mouseoverFunc) this.Div_gen.onmouseover=this.mouseoverFunc;if (this.clickFunc) this.Div_gen.onclick=this.clickFunc;if (this.dblclickFunc) this.Div_gen.ondblclick=this.dblclickFunc;if (this.contextmenuFunc) this.Div_gen.oncontextmenu=this.contextmenuFunc;this.disabled=false;this.setImg1(this.refImg1);if (this.canUpload==true) this.optionDiv.style.display="block";}this.notifyChange(NotifyType.ENABLE,!this.disabled);};ImageComp.prototype.isActive=function(){return !this.disabled;};ImageComp.prototype.onmouseout=function(e){var mouseEvent={"obj":this,"event":e};this.doEventFunc("onmouseout",mouseEvent);};ImageComp.prototype.onmouseover=function(e){var mouseEvent={"obj":this,"event":e};this.doEventFunc("onmouseover",mouseEvent);};ImageComp.prototype.onclick=function(e){var mouseEvent={"obj":this,"event":e};this.doEventFunc("onclick",mouseEvent);};ImageComp.prototype.setVisible=function(visible){if (this.visible==visible) return;if(visible) this.showV();else this.hideV();this.notifyChange(NotifyType.VISIBLE,visible);};ImageComp.prototype.setChangedContext=function(context){if (context.enable !=null) this.setActive(context.enable);if (context.visible !=null&&context.visible !=this.visible){this.visible=context.visible;if (this.visible==true) this.showV();else this.hideV();}if (context.image1 !=null&&context.image1 !=this.refImg1){this.refImg1=context.image1;this.setImg1(this.refImg1);}if (context.image2 !=null&&context.image2 !=this.refImg2){this.refImg2=context.image2;}};